System.register("chunks:///_virtual/AnimationEventHandler.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlayerController.ts","./NPCController.ts"],(function(t){var n,e,o,r,a,i,c;return{setters:[function(t){n=t.inheritsLoose},function(t){e=t.cclegacy,o=t._decorator,r=t.Component},function(t){a=t.PlayerController,i=t.WeaponType},function(t){c=t.NPCController}],execute:function(){var v;e._RF.push({},"86903rEPXFO2YPMWydMq5TH","AnimationEventHandler",void 0);var s=o.ccclass;o.property,t("AnimationEventHandler",s("AnimationEventHandler")(v=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var o=e.prototype;return o.onChainsawAttackEvent=function(){this.sendAttackEvent("melee")},o.onPistolAttackEvent=function(){this.sendAttackEvent("ranged")},o.onMachineGunAttackEvent=function(){this.sendAttackEvent("ranged")},o.onGatlingGunAttackEvent=function(){this.sendAttackEvent("ranged")},o.onMeleeAttackEvent=function(){this.sendAttackEvent("melee")},o.onRangedAttackEvent=function(){this.sendAttackEvent("ranged")},o.onAttackEvent=function(){for(var t=this.node.parent;t;){var n=t.getComponent(a);if(n){var e=n.currentWeaponType===i.CHAINSAW?"melee":"ranged";return void this.sendAttackEvent(e)}t=t.parent}for(t=this.node.parent;t;){var o=t.getComponent(c);if(o)return void o.onAttackEvent("ranged");t=t.parent}},o.sendAttackEvent=function(t){for(var n=this.node.parent;n;){var e=n.getComponent(a);if(e)return void e.onAttackEvent(t);var o=n.getComponent(c);if(o)return void o.onAttackEvent(t);n=n.parent}},e}(r))||v);e._RF.pop()}}}));

System.register("chunks:///_virtual/AttackWarning.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,e,n,r,o,a,s,l,p,c;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.initializerDefineProperty,r=t.assertThisInitialized,o=t.createClass},function(t){a=t.cclegacy,s=t._decorator,l=t.Sprite,p=t.tween,c=t.Component}],execute:function(){var h,u,f,d,g,y,_,v,w,m,b;a._RF.push({},"f86f82NGilH+aqEN71Sc7SK","AttackWarning",void 0);var A=s.ccclass,D=s.property;t("AttackWarning",(h=A("AttackWarning"),u=D({type:l,tooltip:"Sprite组件（不填则自动获取）"}),f=D({tooltip:"淡入时长（秒）"}),d=D({tooltip:"淡出时长（秒）"}),g=D({tooltip:"最大透明度（0-255）"}),h((v=i((_=function(t){function i(){for(var i,e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return i=t.call.apply(t,[this].concat(o))||this,n(i,"sprite",v,r(i)),n(i,"fadeInDuration",w,r(i)),n(i,"fadeOutDuration",m,r(i)),n(i,"maxAlpha",b,r(i)),i._isPlaying=!1,i._tween=null,i}e(i,t);var a=i.prototype;return a.onLoad=function(){if(this.sprite||(this.sprite=this.getComponent(l)),this.sprite&&this.sprite.isValid){var t=this.sprite.color.clone();t.a=0,this.sprite.color=t}},a.play=function(){var t=this;if(this.sprite||(this.sprite=this.getComponent(l)),this.sprite&&this.sprite.isValid){this._isPlaying&&this._tween&&this._tween.stop(),this._isPlaying=!0,this.node.active||(this.node.active=!0);var i=this.sprite.color.clone();i.a=0,this.sprite.color.clone().a=this.maxAlpha,this.sprite.color.clone().a=0,this.sprite.color=i;var e=this.sprite,n={alpha:0};this._tween=p(n).to(this.fadeInDuration,{alpha:this.maxAlpha},{onUpdate:function(){if(e&&e.isValid){var t=e.color.clone();t.a=n.alpha,e.color=t}}}).to(this.fadeOutDuration,{alpha:0},{onUpdate:function(){if(e&&e.isValid){var t=e.color.clone();t.a=n.alpha,e.color=t}},onComplete:function(){t._isPlaying=!1,t._tween=null}}).start()}else console.warn("AttackWarning: Sprite component not found or invalid")},a.stop=function(){if(this._tween&&(this._tween.stop(),this._tween=null),this._isPlaying=!1,this.sprite&&this.sprite.isValid){var t=this.sprite.color.clone();t.a=0,this.sprite.color=t}},o(i,[{key:"isPlaying",get:function(){return this._isPlaying}}]),i}(c)).prototype,"sprite",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=i(_.prototype,"fadeInDuration",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),m=i(_.prototype,"fadeOutDuration",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),b=i(_.prototype,"maxAlpha",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),y=_))||y));a._RF.pop()}}}));

System.register("chunks:///_virtual/BulletController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EnemyController.ts","./VFXManager.ts","./ObjectPool.ts"],(function(t){var i,e,o,r,l,n,s,d,h,a,f,c,_,u;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,o=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){l=t.cclegacy,n=t._decorator,s=t.Prefab,d=t.Vec3,h=t.Quat,a=t.Collider,f=t.Component},function(t){c=t.EnemyController},function(t){_=t.VFXManager},function(t){u=t.ObjectPool}],execute:function(){var g,p,y,m,W,E,P,w,b,R,v,T,V;l._RF.push({},"9daf94WUxBLlJTJrvudPF6I","BulletController",void 0);var z=n.ccclass,D=n.property;t("BulletController",(g=z("BulletController"),p=D({tooltip:"子弹速度（单位/秒）"}),y=D({tooltip:"存活时间（秒），到时自动销毁"}),m=D({tooltip:"子弹伤害"}),W=D({tooltip:"角度偏移范围（度），用于随机偏移子弹方向，例如：5 表示 -5 到 5 度"}),E=D({type:s,tooltip:"子弹跟随特效预制体（由VFXManager管理，跟随子弹位置和旋转）"}),g((b=i((w=function(t){function i(){for(var i,e=arguments.length,l=new Array(e),n=0;n<e;n++)l[n]=arguments[n];return i=t.call.apply(t,[this].concat(l))||this,o(i,"speed",b,r(i)),o(i,"lifeTime",R,r(i)),o(i,"damage",v,r(i)),o(i,"angleOffsetRange",T,r(i)),o(i,"followEffectPrefab",V,r(i)),i.poolKey="",i._dir=new d(0,0,-1),i._timer=0,i._initialY=0,i._currentWorldPos=new d,i._initialWorldRot=new h,i._isDestroyed=!1,i._collider=null,i._followEffectNode=null,i}e(i,t);var l=i.prototype;return l.onLoad=function(){this._collider=this.getComponent(a),this._collider&&(this._collider.isTrigger=!0,this._collider.on("onTriggerEnter",this.onTriggerEnter,this))},l.onEnable=function(){if(this._isDestroyed=!1,this._timer=0,this._dir.set(0,0,-1),this.node.getWorldPosition(this._currentWorldPos),this._initialY=this._currentWorldPos.y,this.node.getWorldRotation(this._initialWorldRot),this._collider||(this._collider=this.getComponent(a)),this._collider&&(this._collider.isTrigger=!0,this._collider.enabled=!0,this._collider.off("onTriggerEnter",this.onTriggerEnter,this),this._collider.on("onTriggerEnter",this.onTriggerEnter,this)),this.followEffectPrefab){var t=_.getInstance();this._followEffectNode=t.playVFX(this.followEffectPrefab,this._currentWorldPos,this._initialWorldRot,this.node.parent,!1,0)}},l.onDestroy=function(){(this._isDestroyed=!0,this._collider&&(this._collider.off("onTriggerEnter",this.onTriggerEnter,this),this._collider=null),this._followEffectNode)&&(_.getInstance().recycleVFX(this._followEffectNode),this._followEffectNode=null)},l.setDirection=function(t,i){if(this.node&&this.node.isValid){if(this.node.getWorldPosition(this._currentWorldPos),this._initialY=this._currentWorldPos.y,t&&t.lengthSqr()>1e-4)this._dir.set(t.x,0,t.z).normalize();else{this.node.getWorldRotation(this._initialWorldRot);var e=new d(0,0,1);d.transformQuat(this._dir,e,this._initialWorldRot),this._dir.y=0,this._dir.normalize()}var o=i;if(void 0===o&&this.angleOffsetRange>.001&&(o=(2*Math.random()-1)*this.angleOffsetRange),void 0!==o&&Math.abs(o)>.001){var r=o*Math.PI/180,l=new h;h.fromAxisAngle(l,d.UP,r),d.transformQuat(this._dir,this._dir,l),this._dir.y=0,this._dir.normalize()}this.node&&this.node.isValid&&(h.fromViewUp(this._initialWorldRot,this._dir,d.UP),this.node.setWorldRotation(this._initialWorldRot))}},l.update=function(t){if(!this._isDestroyed&&this.node&&this.node.isValid)if(this._timer+=t,this._timer>=this.lifeTime)this.recycleBullet();else{var i=this.speed*t;this._currentWorldPos.x+=this._dir.x*i,this._currentWorldPos.z+=this._dir.z*i,this.node&&this.node.isValid&&(this.node.setWorldPosition(this._currentWorldPos.x,this._initialY,this._currentWorldPos.z),this.node.setWorldRotation(this._initialWorldRot)),this._followEffectNode&&this._followEffectNode.isValid&&(this._followEffectNode.setWorldPosition(this._currentWorldPos.x,this._initialY,this._currentWorldPos.z),this._followEffectNode.setWorldRotation(this._initialWorldRot))}},l.onTriggerEnter=function(t){var i;if(!this._isDestroyed&&this.node&&this.node.isValid){var e=null==(i=t.otherCollider)?void 0:i.node;if(e&&e.isValid){var o=e.getComponent(c);o&&!o.isDead&&(o.takeDamage(this.damage),this.node&&this.node.isValid&&this.recycleBullet())}}},l.recycleBullet=function(){if(!this._isDestroyed&&this.node&&this.node.isValid){if(this._isDestroyed=!0,this._collider&&this._collider.off("onTriggerEnter",this.onTriggerEnter,this),this._followEffectNode)_.getInstance().recycleVFX(this._followEffectNode),this._followEffectNode=null;if(this.poolKey&&this.poolKey.length>0)u.getInstance().put(this.poolKey,this.node);else this.node.destroy()}},i}(f)).prototype,"speed",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),R=i(w.prototype,"lifeTime",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),v=i(w.prototype,"damage",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),T=i(w.prototype,"angleOffsetRange",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),V=i(w.prototype,"followEffectPrefab",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=w))||P));l._RF.pop()}}}));

System.register("chunks:///_virtual/CameraFollowController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,o,i,r,l,n,a,s,f,u,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,i=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){l=t.cclegacy,n=t._decorator,a=t.Node,s=t.Camera,f=t.find,u=t.Vec3,c=t.Component}],execute:function(){var h,p,g,w,d,m,y,b,C,F,z,v,P,x,_;l._RF.push({},"0eb33QhTmFM3oGBU/GcYJ7J","CameraFollowController",void 0);var H=n.ccclass,S=n.property;t("CameraFollowController",(h=H("CameraFollowController"),p=S({type:a,tooltip:"要跟随的目标节点（Player）"}),g=S({tooltip:"跟随速度（插值系数，0-1，越大跟随越快）"}),w=S({tooltip:"是否保持固定高度（只跟随X和Z轴）"}),d=S({tooltip:"固定高度值（仅在fixedHeight为true时生效）"}),m=S({tooltip:"偏移量（相对于目标位置）"}),y=S({tooltip:"是否平滑跟随"}),h((F=e((C=function(t){function e(){for(var e,o=arguments.length,l=new Array(o),n=0;n<o;n++)l[n]=arguments[n];return e=t.call.apply(t,[this].concat(l))||this,i(e,"target",F,r(e)),i(e,"followSpeed",z,r(e)),i(e,"fixedHeight",v,r(e)),i(e,"height",P,r(e)),i(e,"offset",x,r(e)),i(e,"smoothFollow",_,r(e)),e._camera=null,e}o(e,t);var l=e.prototype;return l.start=function(){this._camera=this.getComponent(s),this.target||(this.target=f("Player"),this.target||console.warn('CameraFollowController: 未找到目标节点，请在编辑器中指定target或确保场景中存在名为"Player"的节点。'))},l.lateUpdate=function(t){if(this.target&&this.target.isValid){var e=this.target.worldPosition,o=this.node.worldPosition,i=new u(e.x+this.offset.x,this.fixedHeight?this.height+this.offset.y:e.y+this.offset.y,e.z+this.offset.z);if(this.smoothFollow){var r=this.followSpeed*t,l=new u;u.lerp(l,o,i,Math.min(r,1)),this.node.setWorldPosition(l)}else this.node.setWorldPosition(i)}},e}(c)).prototype,"target",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(C.prototype,"followSpeed",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),v=e(C.prototype,"fixedHeight",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),P=e(C.prototype,"height",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),x=e(C.prototype,"offset",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u(0,0,0)}}),_=e(C.prototype,"smoothFollow",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),b=C))||b));l._RF.pop()}}}));

System.register("chunks:///_virtual/CameraFollowPlayer.ts",["cc"],(function(){var e;return{setters:[function(r){e=r.cclegacy}],execute:function(){e._RF.push({},"8be78rl8jhFB6qlFAWzKcmR","CameraFollowPlayer",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/CameraFollowPlayer2.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,r,i,o,n,a,l,c,s,u,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.inheritsLoose,i=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){n=t.cclegacy,a=t._decorator,l=t.v3,c=t.Node,s=t.Camera,u=t.Vec3,p=t.Component}],execute:function(){var d,f,h,m,y,g,w;n._RF.push({},"d2e19SULspHerGrPKCOmL5i","CameraFollowPlayer",void 0);var P=a.ccclass,b=a.property,v=l();t("FollowCamera",(d=P("FollowCamera"),f=b(c),h=b(s),d((g=e((y=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return e=t.call.apply(t,[this].concat(n))||this,i(e,"target",g,o(e)),i(e,"camera",w,o(e)),e.initialDirection=l(),e.speed=0,e}r(e,t);var n=e.prototype;return n.start=function(){u.subtract(this.initialDirection,this.node.worldPosition,this.target.worldPosition)},n.update=function(t){u.add(v,this.target.worldPosition,this.initialDirection),this.node.setWorldPosition(v)},e}(p)).prototype,"target",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=e(y.prototype,"camera",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=y))||m));n._RF.pop()}}}));

System.register("chunks:///_virtual/EnemyAnimationEventHandler.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EnemyController.ts"],(function(n){var t,e,o,r,i;return{setters:[function(n){t=n.inheritsLoose},function(n){e=n.cclegacy,o=n._decorator,r=n.Component},function(n){i=n.EnemyController}],execute:function(){var a;e._RF.push({},"341ccdEoMxBmZ/H6h6owIQV","EnemyAnimationEventHandler",void 0);var c=o.ccclass;n("EnemyAnimationEventHandler",c("EnemyAnimationEventHandler")(a=function(n){function e(){return n.apply(this,arguments)||this}return t(e,n),e.prototype.onAttackEvent=function(){for(var n=this.node.parent;n;){var t=n.getComponent(i);if(t)return void t.onAttackAnimationEvent();n=n.parent}},e}(r))||a);e._RF.pop()}}}));

System.register("chunks:///_virtual/EnemyController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ObjectPool.ts","./HouseController.ts","./VFXManager.ts","./PlayerController.ts"],(function(t){var e,i,n,s,r,o,a,l,h,c,p,m,d,u,_,f,g,y,k,v,b,A,w,D;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,s=t.assertThisInitialized,r=t.createForOfIteratorHelperLoose,o=t.createClass},function(t){a=t.cclegacy,l=t._decorator,h=t.Node,c=t.SkeletalAnimation,p=t.Prefab,m=t.Vec3,d=t.Quat,u=t.SkinnedMeshRenderer,_=t.Collider,f=t.RigidBody,g=t.Color,y=t.find,k=t.Component},function(t){v=t.ObjectPool},function(t){b=t.HouseController},function(t){A=t.VFXManager},function(t){w=t.PlayerController,D=t.WeaponType}],execute:function(){var P,C,R,M,V,E,z,T,I,S,H,x,F,N,L,O,K,W,Y,G,U,j,X,q,B,Q,J,Z,$,tt,et,it,nt,st,rt,ot,at,lt,ht,ct,pt,mt;a._RF.push({},"0cb99y9TotEdbrgLUcuYcm3","EnemyController",void 0);var dt=l.ccclass,ut=l.property;t("EnemyController",(P=dt("EnemyController"),C=ut({type:h,tooltip:"追踪目标（house）"}),R=ut({type:c,tooltip:"动画组件"}),M=ut({tooltip:"移动动画名称"}),V=ut({tooltip:"待机动画名称"}),E=ut({tooltip:"移动速度"}),z=ut({tooltip:"停止距离"}),T=ut({tooltip:"攻击动画名称"}),I=ut({tooltip:"攻击间隔（秒）"}),S=ut({tooltip:"近战攻击范围"}),H=ut({tooltip:"近战攻击伤害"}),x=ut({tooltip:"死亡动画名称"}),F=ut({tooltip:"死亡动画时长（秒）"}),N=ut({tooltip:"下沉速度（单位/秒）"}),L=ut({tooltip:"下沉距离（单位）"}),O=ut({tooltip:"旋转偏移角度 (例如模型朝后则设为 180)"}),K=ut({tooltip:"金币对象池key（需要在ObjectPool中注册）"}),W=ut({type:p,tooltip:"金币预制体（用于对象池）"}),Y=ut({type:p,tooltip:"受击特效预制体（怪物受击时播放，特效位置为怪物位置）"}),G=ut({tooltip:"最大血量"}),P(((mt=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,n(e,"target",X,s(e)),n(e,"anim",q,s(e)),n(e,"runAnim",B,s(e)),n(e,"idleAnim",Q,s(e)),n(e,"speed",J,s(e)),n(e,"stopDistance",Z,s(e)),n(e,"attackAnim",$,s(e)),n(e,"attackInterval",tt,s(e)),n(e,"meleeAttackRange",et,s(e)),n(e,"meleeAttackDamage",it,s(e)),n(e,"dieAnim",nt,s(e)),n(e,"dieAnimDuration",st,s(e)),n(e,"sinkSpeed",rt,s(e)),n(e,"sinkDistance",ot,s(e)),n(e,"rotationOffset",at,s(e)),n(e,"goldPoolKey",lt,s(e)),n(e,"goldPrefab",ht,s(e)),n(e,"hitEffectPrefab",ct,s(e)),n(e,"maxHealth",pt,s(e)),e.poolKey="",e._isMoving=!1,e._attackTimer=0,e._isAttacking=!1,e._attackStartTime=0,e._isDead=!1,e._dieTimer=0,e._isSinking=!1,e._sinkDistance=0,e._initialY=0,e._deathPosition=new m,e._currentHealth=100,e._tempDir=new m,e._tempVelocity=new m,e._tempTargetRot=new d,e._tempOffsetRot=new d,e._tempCurrentRot=new d,e._tempNextRot=new d,e._tempMoveVec=new m,e._tempNewPos=new m,e._zeroVelocity=new m(0,0,0),e._angularFactor=new m(0,1,0),e._skinnedMeshRenderer=null,e._originalEmissiveColor=null,e._isFlashing=!1,e}i(e,t);var a=e.prototype;return a.onEnable=function(){if(this._isDead=!1,this._dieTimer=0,this._isSinking=!1,this._sinkDistance=0,this._isMoving=!1,this._attackTimer=this.attackInterval,this._isAttacking=!1,this._initialY=this.node.worldPosition.y,this._deathPosition.set(this.node.worldPosition),this._currentHealth=this.maxHealth,this._isFlashing=!1,this._skinnedMeshRenderer||(this._skinnedMeshRenderer=this.getComponent(u),this._skinnedMeshRenderer||(this._skinnedMeshRenderer=this.node.getComponentInChildren(u))),this._originalEmissiveColor&&this.restoreEmissive(),this.node&&this.node.isValid){var t=this.getComponent(_);t&&(t.enabled=!0)}var i=this.getComponent(f);i&&(i.type=f.Type.DYNAMIC,i.allowSleep=!1,i.angularFactor=this._angularFactor,i.setLinearVelocity(this._zeroVelocity)),e.enemies.push(this)},a.onDisable=function(){var t=e.enemies.indexOf(this);t>=0&&e.enemies.splice(t,1)},a.start=function(){this.anim||(this.anim=this.getComponent(c)),this._attackTimer=this.attackInterval,this._isAttacking=!1;var t=this.getComponent(f);if(t&&(t.type=f.Type.DYNAMIC,t.allowSleep=!1,t.angularFactor=this._angularFactor),this._skinnedMeshRenderer=this.getComponent(u),this._skinnedMeshRenderer||(this._skinnedMeshRenderer=this.node.getComponentInChildren(u)),this._originalEmissiveColor=new g(0,0,0),this._skinnedMeshRenderer&&this._skinnedMeshRenderer.material){var e=this._skinnedMeshRenderer.material;if(e.getProperty)try{var i=e.getProperty("emissive");i&&"object"==typeof i&&"r"in i&&"g"in i&&"b"in i&&(this._originalEmissiveColor=new g(i.r||0,i.g||0,i.b||0))}catch(t){this._originalEmissiveColor=new g(0,0,0)}}this.goldPrefab&&v.getInstance().registerPrefab(this.goldPoolKey,this.goldPrefab);if(!this.target&&(this.target=y("House"),!this.target&&b.houses.length>0))for(var n,s=Number.MAX_VALUE,o=this.node.worldPosition,a=r(b.houses);!(n=a()).done;){var l=n.value;if(l.node&&l.node.active&&!l.isDestroyed){m.subtract(this._tempDir,l.node.worldPosition,o);var h=this._tempDir.lengthSqr();h<s&&(s=h,this.target=l.node)}}},a.update=function(t){if(this._isSinking){this._sinkDistance+=this.sinkSpeed*t;var e=this.node.worldPosition,i=this._initialY-this._sinkDistance;return this.node.setWorldPosition(e.x,i,e.z),void(this._sinkDistance>=this.sinkDistance&&this.destroyEnemy())}if(!this._isDead||this._isSinking){if(!this._isDead){if(!this.target||!this.target.isValid||!this.target.active){if(this.target=y("House"),(!this.target||!this.target.isValid||!this.target.active)&&b.houses.length>0)for(var n,s=Number.MAX_VALUE,o=this.node.worldPosition,a=r(b.houses);!(n=a()).done;){var l=n.value;if(l.node&&l.node.active&&!l.isDestroyed){m.subtract(this._tempDir,l.node.worldPosition,o);var h=this._tempDir.lengthSqr();h<s&&(s=h,this.target=l.node)}}if(!this.target||!this.target.isValid||!this.target.active)return}var c=this.node.worldPosition,p=this.target.worldPosition,u=p.x-c.x,_=p.z-c.z,g=u*u+_*_;this.stopDistance,this.stopDistance;g>.001&&(this._tempDir.set(u,0,_),this._tempDir.normalize(),d.fromViewUp(this._tempTargetRot,this._tempDir,m.UP),0!==this.rotationOffset&&(d.fromEuler(this._tempOffsetRot,0,this.rotationOffset,0),d.multiply(this._tempTargetRot,this._tempTargetRot,this._tempOffsetRot)),this.node.getWorldRotation(this._tempCurrentRot),d.slerp(this._tempNextRot,this._tempCurrentRot,this._tempTargetRot,10*t),this.node.setWorldRotation(this._tempNextRot));var k=this.getComponent(f);if(this._isAttacking)return k&&(k.getLinearVelocity(this._tempVelocity),this._tempVelocity.x=0,this._tempVelocity.z=0,k.setLinearVelocity(this._tempVelocity)),this._attackStartTime+=t,void(this._attackStartTime>=this.attackInterval&&this.onAttackAnimationEnd());this._attackTimer+=t,g>this.meleeAttackRange*this.meleeAttackRange?(this._tempDir.set(u,0,_),this._tempDir.normalize(),k?(k.getLinearVelocity(this._tempVelocity),this._tempVelocity.x=this._tempDir.x*this.speed,this._tempVelocity.z=this._tempDir.z*this.speed,k.setLinearVelocity(this._tempVelocity)):(m.multiplyScalar(this._tempMoveVec,this._tempDir,this.speed*t),this._tempNewPos.set(c.x+this._tempMoveVec.x,c.y,c.z+this._tempMoveVec.z),this.node.setWorldPosition(this._tempNewPos)),this._isMoving||(this._isMoving=!0,this.playAnim(this.runAnim))):(k&&(k.getLinearVelocity(this._tempVelocity),this._tempVelocity.x=0,this._tempVelocity.z=0,k.setLinearVelocity(this._tempVelocity)),this._attackTimer>=this.attackInterval&&!this._isAttacking?this.startAttack():this._isAttacking||this._isMoving||this.playAnim(this.idleAnim),this._isMoving=!1)}}else if(this._dieTimer+=t,this._dieTimer>=this.dieAnimDuration){this._isSinking=!0,this._initialY=this.node.worldPosition.y,this._sinkDistance=0;var v=this.getComponent(f);v&&(v.type=f.Type.KINEMATIC)}},a.playAnim=function(t){var e=this;this.anim&&(t===this.attackAnim&&this.anim.once(c.EventType.FINISHED,(function(){e.onAttackAnimationEnd()}),this),this.anim.crossFade(t,.3))},a.takeDamage=function(t){this._isDead||(this._currentHealth-=t,this.playHitEffect(),this.flashEmissive(),this._currentHealth<=0&&(this._currentHealth=0,this.die()))},a.playHitEffect=function(){if(this.hitEffectPrefab){var t=this.node.worldPosition;A.getInstance().play(this.hitEffectPrefab,t,this.node.parent)}},a.die=function(){if(!this._isDead){this._isDead=!0,this._dieTimer=0,this._deathPosition.set(this.node.worldPosition);var t=this.getComponent(f);if(t&&(t.setLinearVelocity(this._zeroVelocity),t.type=f.Type.KINEMATIC),this.node&&this.node.isValid){var i=this.getComponent(_);i&&(i.enabled=!1)}var n=e.enemies.indexOf(this);n>=0&&e.enemies.splice(n,1),this.spawnGold(),this.playAnim(this.dieAnim)}},a.spawnGold=function(){var t=y("Player");if(t){var e=t.getComponent(w);if(e&&e.currentWeaponType===D.GATLING_GUN)return}var i=this._deathPosition.clone();i.y+=.1;var n=v.getInstance().get(this.goldPoolKey,this.node.parent);n&&(n.active||(n.active=!0),n.setWorldPosition(i))},a.destroyEnemy=function(){this.poolKey&&this.poolKey.length>0?v.getInstance().put(this.poolKey,this.node):this.node.destroy()},a.startAttack=function(){this._isAttacking||this._isDead||(this._isAttacking=!0,this._attackStartTime=0,this.playAnim(this.attackAnim),this._attackTimer=0)},a.onAttackAnimationEvent=function(){this._isAttacking&&!this._isDead&&this.performMeleeAttack()},a.onAttackAnimationEnd=function(){this._isAttacking=!1,this._attackTimer=this.attackInterval},a.performMeleeAttack=function(){if(this.target&&!this._isDead){var t=this.target.getComponent(b);t&&!t.isDestroyed&&t.takeDamage(this.meleeAttackDamage)}},a.flashEmissive=function(){var t=this;if(this._skinnedMeshRenderer&&this._skinnedMeshRenderer.material&&!this._isFlashing){this._isFlashing=!0;var e=this._skinnedMeshRenderer.material,i=new g(255,0,0);try{if(e.setProperty)for(var n=0,s=["emissive","emissiveColor","emissive","_emissive"];n<s.length;n++){var r=s[n];try{e.setProperty(r,i);break}catch(t){}}}catch(t){console.warn("EnemyController: 无法设置自发光属性",t)}this.scheduleOnce((function(){t.restoreEmissive()}),.2)}},a.restoreEmissive=function(){if(this._skinnedMeshRenderer&&this._skinnedMeshRenderer.material){var t=this._skinnedMeshRenderer.material,e=this._originalEmissiveColor||new g(0,0,0);try{if(t.setProperty)for(var i=0,n=["emissive","emissiveColor","emissive","_emissive"];i<n.length;i++){var s=n[i];try{t.setProperty(s,e);break}catch(t){}}}catch(t){console.warn("EnemyController: 无法恢复自发光属性",t)}this._isFlashing=!1}else this._isFlashing=!1},o(e,[{key:"isDead",get:function(){return this._isDead}},{key:"currentHealth",get:function(){return this._currentHealth}}]),e}(k)).enemies=[],X=e((j=mt).prototype,"target",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=e(j.prototype,"anim",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(j.prototype,"runAnim",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"run"}}),Q=e(j.prototype,"idleAnim",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"idle"}}),J=e(j.prototype,"speed",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),Z=e(j.prototype,"stopDistance",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),$=e(j.prototype,"attackAnim",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"attack"}}),tt=e(j.prototype,"attackInterval",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),et=e(j.prototype,"meleeAttackRange",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),it=e(j.prototype,"meleeAttackDamage",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),nt=e(j.prototype,"dieAnim",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"die"}}),st=e(j.prototype,"dieAnimDuration",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),rt=e(j.prototype,"sinkSpeed",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ot=e(j.prototype,"sinkDistance",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),at=e(j.prototype,"rotationOffset",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 180}}),lt=e(j.prototype,"goldPoolKey",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Gold"}}),ht=e(j.prototype,"goldPrefab",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ct=e(j.prototype,"hitEffectPrefab",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pt=e(j.prototype,"maxHealth",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),U=j))||U));a._RF.pop()}}}));

System.register("chunks:///_virtual/FailButtonHandler.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIManager.ts"],(function(t){var n,i,o,e,s,u,a;return{setters:[function(t){n=t.inheritsLoose},function(t){i=t.cclegacy,o=t._decorator,e=t.Button,s=t.director,u=t.Component},function(t){a=t.UIManager}],execute:function(){var l;i._RF.push({},"fa653xjZoxPt61B0mL9vMdi","FailButtonHandler",void 0);var r=o.ccclass;t("FailButtonHandler",r("FailButtonHandler")(l=function(t){function i(){for(var n,i=arguments.length,o=new Array(i),e=0;e<i;e++)o[e]=arguments[e];return(n=t.call.apply(t,[this].concat(o))||this).failButton=null,n._isDestroyed=!1,n}n(i,t);var o=i.prototype;return o.findButtonInChildren=function(t){if(!t||!t.isValid)return null;var n=t.getComponent(e);if(n)return n;var i=t.children;if(i)for(var o=0;o<i.length;o++){var s=i[o];if(s&&s.isValid){var u=this.findButtonInChildren(s);if(u)return u}}return null},o.bindButtonEvent=function(){this.failButton&&this.failButton.node&&this.failButton.node.isValid&&(this.failButton.node.off(e.EventType.CLICK,this.onButtonClick,this),this.failButton.node.on(e.EventType.CLICK,this.onButtonClick,this),this.failButton.interactable=!0)},o.onLoad=function(){this._isDestroyed=!1,this.failButton=this.getComponent(e)||this.findButtonInChildren(this.node),this.bindButtonEvent()},o.start=function(){this.failButton&&this.failButton.node&&this.failButton.node.isValid||(this.failButton=this.getComponent(e)||this.findButtonInChildren(this.node)),this.bindButtonEvent()},o.onDestroy=function(){this._isDestroyed=!0,this.failButton&&this.failButton.node&&this.failButton.node.isValid&&this.failButton.node.off(e.EventType.CLICK,this.onButtonClick,this),this.failButton=null},o.onButtonClick=function(t){!this._isDestroyed&&t&&(s.isPaused()&&s.resume(),this.scheduleOnce((function(){var t=s.getScene(),n=t&&t.name?t.name:"scene";a.resetInstance(),s.loadScene(n)}),.1))},i}(u))||l);i._RF.pop()}}}));

System.register("chunks:///_virtual/GoldController.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var i,t,n,o,a,l,r,s,c,p,d,h;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized,a=e.createClass},function(e){l=e.cclegacy,r=e._decorator,s=e.Vec3,c=e.RigidBody,p=e.randomRange,d=e.Collider,h=e.Component}],execute:function(){var u,g,m,_,f,y,C,v,w,b;l._RF.push({},"0ee45KKWBlNLqYXuaS/NCPN","GoldController",void 0);var T=r.ccclass,A=r.property;e("GoldController",(u=T("GoldController"),g=A({tooltip:"掉落初始速度（向上抛起的速度）"}),m=A({tooltip:"掉落初始水平速度范围（随机）"}),_=A({tooltip:"生成后多久才能被收集（秒）"}),u(((b=function(e){function i(){for(var i,t=arguments.length,a=new Array(t),l=0;l<t;l++)a[l]=arguments[l];return i=e.call.apply(e,[this].concat(a))||this,n(i,"initialUpwardSpeed",C,o(i)),n(i,"initialHorizontalSpeedRange",v,o(i)),i._isCollected=!1,i._isAnimating=!1,i._startPos=new s,i._targetPos=new s,i._animationTime=0,i._animationDuration=.5,i._elapsedTime=0,n(i,"collectDelay",w,o(i)),i}t(i,e);var l=i.prototype;return l.onEnable=function(){var e=this;this._isCollected=!1,this._isAnimating=!1,this._animationTime=0,this._elapsedTime=0,i.golds.push(this),this.scheduleOnce((function(){if(e.node&&e.node.isValid&&e.node.active){var i=e.getComponent(c);if(i){i.type=c.Type.DYNAMIC,i.allowSleep=!1,i.wakeUp(),i.setLinearVelocity(s.ZERO),i.setAngularVelocity(s.ZERO);var t=new s(p(-1,1),0,p(-1,1));t.lengthSqr()<.01&&t.set(1,0,0),t.normalize();var n=p(.5,e.initialHorizontalSpeedRange),o=p(.8*e.initialUpwardSpeed,1.2*e.initialUpwardSpeed),a=Math.max(0,o),l=new s(t.x*n,a,t.z*n);i.setLinearVelocity(l)}}}),0)},l.onDisable=function(){var e=i.golds.indexOf(this);e>=0&&i.golds.splice(e,1)},l.update=function(e){this._isCollected||(this._elapsedTime+=e)},l.collectToBackpack=function(e){if(!this._isCollected&&!this._isAnimating){this._isCollected=!0,this._isAnimating=!0,this._animationTime=0;var i=this.getComponent(c);if(i){i.type=c.Type.KINEMATIC,i.enabled=!1;var t=new s;i.setLinearVelocity(t),i.setAngularVelocity(s.ZERO)}var n=this.getComponent(d);n&&(n.enabled=!1),this._startPos.set(this.node.worldPosition),this._targetPos.set(e)}},l.updateAnimation=function(e,i){if(this._isAnimating){i&&this._targetPos.set(i),this._animationTime+=e;var t=Math.min(this._animationTime/this._animationDuration,1),n=1-Math.pow(1-t,3),o=new s;if(s.lerp(o,this._startPos,this._targetPos,n),this.node.setWorldPosition(o),t>=1){this._isAnimating=!1;var a=this.getComponent(c);a&&(a.type=c.Type.KINEMATIC,a.enabled=!1);var l=this.getComponent(d);l&&(l.enabled=!1)}}},a(i,[{key:"isCollected",get:function(){return this._isCollected}},{key:"isAnimating",get:function(){return this._isAnimating}},{key:"canBeCollected",get:function(){return this._elapsedTime>=this.collectDelay}}]),i}(h)).golds=[],C=i((y=b).prototype,"initialUpwardSpeed",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),v=i(y.prototype,"initialHorizontalSpeedRange",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),w=i(y.prototype,"collectDelay",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),f=y))||f));l._RF.pop()}}}));

System.register("chunks:///_virtual/GoldPlaceController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlayerController.ts","./GoldController.ts","./ObjectPool.ts","./NPCController.ts","./VFXManager.ts"],(function(e){var t,i,o,r,n,l,s,a,c,h,p,u,d,g,f,P,_,y,m,C,b;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,o=e.initializerDefineProperty,r=e.assertThisInitialized,n=e.createForOfIteratorHelperLoose},function(e){l=e.cclegacy,s=e._decorator,a=e.Node,c=e.Prefab,h=e.MeshRenderer,p=e.Vec3,u=e.Collider,d=e.instantiate,g=e.tween,f=e.Component},function(e){P=e.PlayerController,_=e.WeaponType},function(e){y=e.GoldController},function(e){m=e.ObjectPool},function(e){C=e.NPCController},function(e){b=e.VFXManager}],execute:function(){var v,G,N,w,T,S,L,U,z,k,I,E,R,M,x,V,K,A,D,F,W,H,O,q,B,j,X,J,Q,Y,Z,$,ee;l._RF.push({},"4186dshOpRF9IpLzik9xhoy","GoldPlaceController",void 0);var te=s.ccclass,ie=s.property;e("GoldPlaceController",(v=te("GoldPlaceController"),G=ie({tooltip:"金币对象池key（需要在ObjectPool中注册）"}),N=ie({tooltip:"回收动画时长（秒）"}),w=ie({tooltip:"抛物线高度（回收动画的峰值高度）"}),T=ie({tooltip:"回收范围检测间隔（秒）"}),S=ie({tooltip:"缩放反馈动画时长（秒）"}),L=ie({type:a,tooltip:"玩家节点（可选，不填则自动查找）"}),U=ie({type:[Number],tooltip:"每次升级需要的金币数量（数组，共3次升级）"}),z=ie({type:[c],tooltip:"每次升级对应的预制体（数组，共3个，按顺序对应3次升级）"}),k=ie({type:[a],tooltip:"NPC等待位置节点数组（共3个，对应3次升级生成的NPC，每个NPC没有敌人时会移动到对应的位置等待，不填则使用当前Place gold的位置）"}),I=ie({tooltip:"NPC对象池key（如果使用对象池生成NPC，需要填写此key，所有升级的NPC共用同一个key）"}),E=ie({type:c,tooltip:"NPC升级特效预制体（NPC生成时播放，跟随NPC移动）"}),R=ie({tooltip:"NPC升级特效持续时间（秒）"}),M=ie({type:h,tooltip:"用于显示进度的网格体"}),x=ie({tooltip:"当前金币值的材质属性名"}),V=ie({tooltip:"最大金币值的材质属性名"}),v((D=t((A=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return t=e.call.apply(e,[this].concat(n))||this,o(t,"goldPoolKey",D,r(t)),o(t,"collectAnimationDuration",F,r(t)),o(t,"parabolaHeight",W,r(t)),o(t,"checkInterval",H,r(t)),o(t,"scaleAnimationDuration",O,r(t)),o(t,"playerNode",q,r(t)),o(t,"upgradeGoldCounts",B,r(t)),o(t,"upgradePrefabs",j,r(t)),o(t,"npcWaitPositions",X,r(t)),o(t,"npcPoolKey",J,r(t)),o(t,"npcUpgradeEffectPrefab",Q,r(t)),o(t,"npcUpgradeEffectLifeTime",Y,r(t)),o(t,"progressMesh",Z,r(t)),o(t,"currentGoldPropName",$,r(t)),o(t,"maxGoldPropName",ee,r(t)),t._collectedCount=0,t._currentUpgradeLevel=0,t._currentLevelRequiredCount=0,t._pendingGoldCount=0,t._checkTimer=0,t._isCollecting=!1,t._isPlayerInRange=!1,t._collider=null,t._collectingGolds=new Map,t._initialScale=new p(1,1,1),t._tempVec3_1=new p,t._tempVec3_2=new p,t._tempVec3_3=new p,t._tempCurrentPos=new p,t._tempScale_08=new p,t._tempScale_12=new p,t}i(t,e);var l=t.prototype;return l.onLoad=function(){var e;if((this._collider=this.getComponent(u),this._collider&&(this._collider.isTrigger=!0,this._collider.on("onTriggerEnter",this.onTriggerEnter,this),this._collider.on("onTriggerStay",this.onTriggerStay,this),this._collider.on("onTriggerExit",this.onTriggerExit,this)),!this.playerNode)&&(this.playerNode=(null==(e=this.node.scene)?void 0:e.getChildByName("Player"))||null,!this.playerNode)){var t,i=null==(t=this.node.scene)?void 0:t.getComponentInChildren(P);i&&(this.playerNode=i.node)}if(this._initialScale=this.node.scale.clone(),this.initializeUpgradeSystem(),this.npcPoolKey&&this.npcPoolKey.length>0)for(var o,r=m.getInstance(),l=n(this.upgradePrefabs);!(o=l()).done;){var s=o.value;if(s&&!r.isRegistered(this.npcPoolKey)){r.registerPrefab(this.npcPoolKey,s);break}}},l.initializeUpgradeSystem=function(){if(this.upgradeGoldCounts.length<3)for(;this.upgradeGoldCounts.length<3;)this.upgradeGoldCounts.push(10);if(this.upgradePrefabs.length<3)for(;this.upgradePrefabs.length<3;)this.upgradePrefabs.push(null);this._currentLevelRequiredCount=this.upgradeGoldCounts[0],this._currentUpgradeLevel=0,this._collectedCount=0,this._pendingGoldCount=0,this.updateProgressBar()},l.onDestroy=function(){this._collider&&(this._collider.off("onTriggerEnter",this.onTriggerEnter,this),this._collider.off("onTriggerStay",this.onTriggerStay,this),this._collider.off("onTriggerExit",this.onTriggerExit,this))},l.update=function(e){this._checkTimer+=e,this._checkTimer>=this.checkInterval&&(this._checkTimer=0,this.checkPlayerGolds()),this._collectingGolds.size>0&&this.updateCollectingGolds(e)},l.onTriggerEnter=function(e){this._currentUpgradeLevel>=3||e.otherCollider.node.getComponent(P)&&(this._isPlayerInRange=!0,this.checkPlayerGolds())},l.onTriggerStay=function(e){this._currentUpgradeLevel>=3||e.otherCollider.node.getComponent(P)&&(this._isPlayerInRange=!0)},l.onTriggerExit=function(e){e.otherCollider.node.getComponent(P)&&(this._isPlayerInRange=!1)},l.checkPlayerGolds=function(){if(!(this._currentUpgradeLevel>=3)&&this._isPlayerInRange&&this.playerNode){var e=this.playerNode.getComponent(P);if(e){var t=e.getCollectedGolds();if(t&&t.length>0&&!(this._pendingGoldCount>=this._currentLevelRequiredCount||(this._pendingGoldCount++,this._pendingGoldCount>this._currentLevelRequiredCount)))for(var i=t.length-1;i>=0;i--){var o=t[i];if(o&&o.isValid&&o.active&&!this._collectingGolds.has(o)){this.collectGold(o,e);break}}}}},l.collectGold=function(e,t){if(!this._collectingGolds.has(e)&&(e.getComponent(y)&&t.removeCollectedGold(e))){var i=e.worldPosition.clone(),o=this.node.worldPosition.clone();this._tempVec3_1.set(i.x,0,i.z),this._tempVec3_2.set(o.x,0,o.z);var r=p.distance(this._tempVec3_1,this._tempVec3_2),n=Math.min(this.parabolaHeight,.5*r);this._collectingGolds.set(e,{startPos:i,targetPos:o,time:0,duration:this.collectAnimationDuration,peakHeight:n}),this._isCollecting=this._collectingGolds.size>0}},l.updateCollectingGolds=function(e){var t=this,i=[];this._collectingGolds.forEach((function(o,r){if(r&&r.isValid&&r.active){o.time+=e;var n=Math.min(o.time/o.duration,1),l=1-Math.pow(1-n,3);p.lerp(t._tempCurrentPos,o.startPos,o.targetPos,l);var s=o.startPos.y+(o.targetPos.y-o.startPos.y)*n+4*o.peakHeight*n*(1-n);t._tempCurrentPos.y=s,r.setWorldPosition(t._tempCurrentPos),n>=1&&i.push(r)}else i.push(r)})),i.forEach((function(e){t.returnGoldToPool(e)}))},l.returnGoldToPool=function(e){if(e&&e.isValid){this._collectingGolds.delete(e),0===this._collectingGolds.size&&(this._isCollecting=!1),this._collectedCount++,this.updateProgressBar(),this.playScaleFeedbackAnimation(),this._collectedCount>=this._currentLevelRequiredCount&&this.performUpgrade();e.getComponent(y);m.getInstance().put(this.goldPoolKey,e)}},l.disableCollider=function(){this._collider&&(this._collider.enabled=!1),this._isPlayerInRange=!1},l.destroySelf=function(){var e=this;this._collectingGolds.size>0?this.scheduleOnce((function(){e.destroySelf()}),this.collectAnimationDuration):this.node.destroy()},l.performUpgrade=function(){var e=this;this._currentUpgradeLevel++,this._currentUpgradeLevel<=3&&this.upgradePrefabs[this._currentUpgradeLevel-1]&&this.spawnUpgradePrefab(this._currentUpgradeLevel-1),this.upgradePlayerWeapon(),this._currentUpgradeLevel>=3?(this.disableCollider(),this.scheduleOnce((function(){e.destroySelf()}),this.collectAnimationDuration+.2)):(this._currentLevelRequiredCount=this.upgradeGoldCounts[this._currentUpgradeLevel],this._collectedCount=0,this._pendingGoldCount=0,this.updateProgressBar())},l.upgradePlayerWeapon=function(){if(this.playerNode){var e=this.playerNode.getComponent(P);if(e){var t;switch(this._currentUpgradeLevel){case 1:t=_.PISTOL;break;case 2:t=_.MACHINE_GUN;break;case 3:t=_.GATLING_GUN;break;default:return}e.switchWeapon(t)}}},l.spawnUpgradePrefab=function(e){if(!(e<0||e>=this.upgradePrefabs.length)){var t=this.upgradePrefabs[e];if(t){var i=null,o=this.node.parent||this.node.scene;if(this.npcPoolKey&&this.npcPoolKey.length>0)i=m.getInstance().get(this.npcPoolKey,o);else(i=d(t)).parent=o||this.node.scene;if(i){var r=this.node.worldPosition.clone();r.y+=.1,i.setWorldPosition(r);var n=i.getComponent(C);if(n||(n=i.getComponentInChildren(C)),n){this.npcPoolKey&&this.npcPoolKey.length>0&&(n.poolKey=this.npcPoolKey);var l=null;e>=0&&e<this.npcWaitPositions.length&&(l=this.npcWaitPositions[e]),l&&l.isValid||(l=this.node),n.setWaitPosition(l)}if(this.npcUpgradeEffectPrefab&&i){var s=b.getInstance(),a=i.worldPosition.clone(),c=s.playVFX(this.npcUpgradeEffectPrefab,a,null,i,!0,this.npcUpgradeEffectLifeTime);c&&c.isValid&&i.isValid&&(c.parent!==i&&(c.parent=i),c.setPosition(0,0,0))}}else console.warn("GoldPlaceController: 无法创建升级节点")}}},l.spawnTurret=function(){},l.convertPropertyNameToShaderFormat=function(e){if(!e)return e;for(var t=e.split(/\s+/),i="",o=0;o<t.length;o++){var r=t[o];r.length>0&&(i+=r.charAt(0).toUpperCase()+r.slice(1))}return i},l.updateProgressBar=function(){if(this.progressMesh){var e=this._currentLevelRequiredCount,t=Math.max(0,this._currentLevelRequiredCount-this._collectedCount),i=this.progressMesh.material;if(i){var o=this.convertPropertyNameToShaderFormat(this.currentGoldPropName),r=this.convertPropertyNameToShaderFormat(this.maxGoldPropName);try{i.setProperty(o,t),i.setProperty(r,e)}catch(e){}if(i.passes&&i.passes.length>0)for(var n=0;n<i.passes.length;n++){var l=i.passes[n];if(l)try{var s=l.getHandle(o),a=l.getHandle(r);-1!==s&&l.setUniform(s,t),-1!==a&&l.setUniform(a,e)}catch(e){}}}}},l.setCurrentGold=function(e){this._collectedCount=e,this.updateProgressBar()},l.setMaxGold=function(e){this._currentLevelRequiredCount=e,this.updateProgressBar()},l.getProgressMesh=function(){return this.progressMesh},l.setProgressMesh=function(e){this.progressMesh=e,this.updateProgressBar()},l.playScaleFeedbackAnimation=function(){var e=this.scaleAnimationDuration;g(this.node).stop(),this._tempScale_08.set(.8*this._initialScale.x,.8*this._initialScale.y,.8*this._initialScale.z),this._tempScale_12.set(1.2*this._initialScale.x,1.2*this._initialScale.y,1.2*this._initialScale.z),g(this.node).to(.25*e,{scale:this._tempScale_08.clone()},{easing:"sineOut"}).to(.5*e,{scale:this._tempScale_12.clone()},{easing:"sineInOut"}).to(.25*e,{scale:this._initialScale.clone()},{easing:"sineIn"}).start()},t}(f)).prototype,"goldPoolKey",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Gold"}}),F=t(A.prototype,"collectAnimationDuration",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),W=t(A.prototype,"parabolaHeight",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),H=t(A.prototype,"checkInterval",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),O=t(A.prototype,"scaleAnimationDuration",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),q=t(A.prototype,"playerNode",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(A.prototype,"upgradeGoldCounts",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[10,20,30]}}),j=t(A.prototype,"upgradePrefabs",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),X=t(A.prototype,"npcWaitPositions",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),J=t(A.prototype,"npcPoolKey",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Q=t(A.prototype,"npcUpgradeEffectPrefab",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=t(A.prototype,"npcUpgradeEffectLifeTime",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),Z=t(A.prototype,"progressMesh",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(A.prototype,"currentGoldPropName",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"currentGold"}}),ee=t(A.prototype,"maxGoldPropName",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"maxGold"}}),K=A))||K));l._RF.pop()}}}));

System.register("chunks:///_virtual/HouseController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIManager.ts"],(function(e){var t,r,s,a,o,i,n,h,l,u,c;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,s=e.initializerDefineProperty,a=e.assertThisInitialized,o=e.createForOfIteratorHelperLoose,i=e.createClass},function(e){n=e.cclegacy,h=e._decorator,l=e.MeshRenderer,u=e.Component},function(e){c=e.UIManager}],execute:function(){var p,f,y,d,H,g,m,v,D,b;n._RF.push({},"dfb893X15JOU4XIadBze8KP","HouseController",void 0);var P=h.ccclass,C=h.property;e("HouseController",(p=P("HouseController"),f=C({tooltip:"最大生命值"}),y=C({type:l,tooltip:"用于显示血量的网格体"}),d=C({tooltip:"血量比例的材质属性名（例如：healthRatio）"}),p(((b=function(e){function t(){for(var t,r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=e.call.apply(e,[this].concat(o))||this,s(t,"maxHealth",m,a(t)),s(t,"progressMesh",v,a(t)),s(t,"healthRatioPropName",D,a(t)),t.currentHealth=0,t._isDestroyed=!1,t}r(t,e);var n=t.prototype;return n.onEnable=function(){this._isDestroyed=!1,this.currentHealth=this.maxHealth,t.houses.push(this),this.updateProgressBar()},n.onDisable=function(){var e=t.houses.indexOf(this);e>=0&&t.houses.splice(e,1)},n.start=function(){this.currentHealth<=0&&(this.currentHealth=this.maxHealth),this.updateProgressBar()},n.takeDamage=function(e){if(!this._isDestroyed){this.currentHealth-=e,this.updateProgressBar();var t=c.getInstance();t&&t.playAttackWarning(),this.currentHealth<=0&&(this.currentHealth=0,this.updateProgressBar(),this.destroyHouse())}},n.destroyHouse=function(){this._isDestroyed||(this._isDestroyed=!0,this.currentHealth=0,t.onHouseDestroyedCallback&&t.onHouseDestroyedCallback(this))},n.convertPropertyNameToShaderFormat=function(e){if(!e)return e;for(var t=e.split(/\s+/),r="",s=0;s<t.length;s++){var a=t[s];a.length>0&&(r+=a.charAt(0).toUpperCase()+a.slice(1))}return r},n.updateProgressBar=function(){if(this.progressMesh){var e=this.maxHealth>0?Math.max(0,Math.min(1,this.currentHealth/this.maxHealth)):0,t=this.progressMesh.material;if(t){var r=this.convertPropertyNameToShaderFormat(this.healthRatioPropName);try{t.setProperty(r,e)}catch(e){}if(t.passes&&t.passes.length>0)for(var s=0;s<t.passes.length;s++){var a=t.passes[s];if(a)try{var o=a.getHandle(r);-1!==o&&a.setUniform(o,e)}catch(e){}}}}},t.isAnyHouseDestroyed=function(){for(var e,r=o(t.houses);!(e=r()).done;){if(e.value.isDestroyed)return!0}return!1},i(t,[{key:"isDestroyed",get:function(){return this._isDestroyed}}]),t}(u)).houses=[],b.onHouseDestroyedCallback=null,m=t((g=b).prototype,"maxHealth",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),v=t(g.prototype,"progressMesh",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(g.prototype,"healthRatioPropName",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"healthRatio"}}),H=g))||H));n._RF.pop()}}}));

System.register("chunks:///_virtual/Joystick.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var i,e,n,s,o,r,c,a,h,u,l,d,p,f,y,k;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.initializerDefineProperty,s=t.assertThisInitialized},function(t){o=t.cclegacy,r=t._decorator,c=t.Node,a=t.Vec2,h=t.Vec3,u=t.Layers,l=t.Sprite,d=t.resources,p=t.SpriteFrame,f=t.Input,y=t.UITransform,k=t.Component}],execute:function(){var v,T,g,_,E,m,P,C,b,O,w,S;o._RF.push({},"517aaFbqGVFuJwmV6bth2Nh","Joystick",void 0);var U=r.ccclass,F=r.property;t("Joystick",(v=U("Joystick"),T=F({type:c,tooltip:"摇杆背景节点"}),g=F({type:c,tooltip:"摇杆中心节点"}),_=F({tooltip:"摇杆半径"}),E=F({tooltip:"输入角度偏移（度），用于校正摄像机旋转带来的方向偏差"}),v(((S=function(t){function i(){for(var i,e=arguments.length,o=new Array(e),r=0;r<e;r++)o[r]=arguments[r];return i=t.call.apply(t,[this].concat(o))||this,n(i,"ring",C,s(i)),n(i,"stick",b,s(i)),n(i,"radius",O,s(i)),n(i,"angleOffset",w,s(i)),i.direction=new a(0,0),i._startPos=new h,i._stickPos=new h,i}e(i,t);var o=i.prototype;return o.onLoad=function(){i.instance=this,this.ring&&this.stick?(this.initEvents(),this.hideJoystick()):this.createJoystickNodes()},o.hideJoystick=function(){this.ring&&(this.ring.active=!1),this.stick&&(this.stick.active=!1)},o.createJoystickNodes=function(){var t=this,i=0,e=function(){++i>=2&&(t.initEvents(),t.hideJoystick())};if(this.ring)e();else{this.ring=new c("Ring"),this.ring.layer=u.Enum.UI_2D,this.ring.parent=this.node;var n=this.ring.addComponent(l);d.load("ui/2d/rocker_frame/spriteFrame",p,(function(t,i){t?console.error("Failed to load rocker_frame:",t):n.spriteFrame=i,e()}))}if(this.stick)e();else{this.stick=new c("Stick"),this.stick.layer=u.Enum.UI_2D,this.stick.parent=this.node;var s=this.stick.addComponent(l);d.load("ui/2d/rocker_point/spriteFrame",p,(function(t,i){t?console.error("Failed to load rocker_point:",t):s.spriteFrame=i,e()}))}},o.initEvents=function(){this.node.on(f.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(f.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(f.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(f.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},o.onTouchStart=function(t){var i=this.node.getComponent(y);if(i){var e=t.getUILocation(),n=i.convertToNodeSpaceAR(new h(e.x,e.y,0));this._startPos.set(n),this.ring&&(this.ring.setPosition(n),this.ring.active=!0),this.stick&&(this.stick.setPosition(n),this.stick.active=!0),this.direction.set(0,0)}},o.onTouchMove=function(t){var i=this.node.getComponent(y);if(i){var e=t.getUILocation(),n=i.convertToNodeSpaceAR(new h(e.x,e.y,0)).subtract(this._startPos);this.updateStickPosition(n)}},o.onTouchEnd=function(t){this.direction.set(0,0),this.hideJoystick()},o.updateStickPosition=function(t){if(this.stick){var i=Math.sqrt(t.x*t.x+t.y*t.y);if(i>this.radius){var e=this.radius/i;this._stickPos.set(t.x*e,t.y*e,0)}else this._stickPos.set(t.x,t.y,0);var n=this._startPos.clone().add(this._stickPos);this.stick.setPosition(n);var s=this._stickPos.x/this.radius,o=this._stickPos.y/this.radius;if(0!==this.angleOffset){var r=this.angleOffset*Math.PI/180,c=Math.cos(r),a=Math.sin(r),h=s*a+o*c;s=s*c-o*a,o=h}this.direction.set(s,o)}},o.onDestroy=function(){i.instance===this&&(i.instance=null),this.node.off(f.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(f.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(f.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(f.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},i}(k)).instance=null,C=i((P=S).prototype,"ring",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=i(P.prototype,"stick",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=i(P.prototype,"radius",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),w=i(P.prototype,"angleOffset",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),m=P))||m));o._RF.pop()}}}));

System.register("chunks:///_virtual/Level.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIManager.ts","./HouseController.ts"],(function(e){var t,n,o,s,i,r,a;return{setters:[function(e){t=e.inheritsLoose},function(e){n=e.cclegacy,o=e._decorator,s=e.director,i=e.Component},function(e){r=e.UIManager},function(e){a=e.HouseController}],execute:function(){var c;n._RF.push({},"2f4deV1pU5DNLqlmnsdaNh7","Level",void 0);var u=o.ccclass;e("Level",u("Level")(c=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var o=n.prototype;return o.onLoad=function(){var e=this;a.onHouseDestroyedCallback=function(t){e.onHouseDestroyed(t)},this.checkInitialState()},o.start=function(){r.getInstance()&&this.checkInitialState()},o.onDestroy=function(){a.onHouseDestroyedCallback=null},o.checkInitialState=function(){if(a.houses.some((function(e){return e&&e.isDestroyed})))this.handleGameOver();else{var e=r.getInstance();e&&(e.showJoystick(),e.hideWin(),e.hideFail())}},o.onHouseDestroyed=function(e){this.handleGameOver()},o.handleGameOver=function(){var e=r.getInstance();e&&e.showFailAndCloseOthers(),s.pause()},n}(i))||c);n._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./CameraFollowPlayer2.ts","./AnimationEventHandler.ts","./BulletController.ts","./CameraFollowController.ts","./CameraFollowPlayer.ts","./EnemyAnimationEventHandler.ts","./EnemyController.ts","./GoldController.ts","./GoldPlaceController.ts","./HouseController.ts","./Level.ts","./PlayerController.ts","./PlayerShootMove.ts","./ShellController.ts","./SpawnEnemy.ts","./TurretController.ts","./NPCController.ts","./AttackWarning.ts","./FailButtonHandler.ts","./Joystick.ts","./UIManager.ts","./ObjectPool.ts","./RecycleMonitor.ts","./VFXManager.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/NPCController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EnemyController.ts","./BulletController.ts","./VFXManager.ts","./ObjectPool.ts"],(function(t){var i,e,n,o,r,l,a,s,u,c,b,f,h,p,m,d,g,P,y;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createForOfIteratorHelperLoose},function(t){l=t.cclegacy,a=t._decorator,s=t.SkeletalAnimation,u=t.Prefab,c=t.Node,b=t.RigidBody,f=t.Vec3,h=t.Quat,p=t.instantiate,m=t.Component},function(t){d=t.EnemyController},function(t){g=t.BulletController},function(t){P=t.VFXManager},function(t){y=t.ObjectPool}],execute:function(){var w,v,_,A,z,T,k,C,R,V,F,M,W,E,L,K,D,N,U,S,I,B,x,X,O,j,q,H,Q,Y,G,J,Z,$,tt,it,et,nt,ot;l._RF.push({},"bf4dd10wfNOnbcbEwmVMUxl","NPCController",void 0);var rt=a.ccclass,lt=a.property;t("NPCController",(w=rt("NPCController"),v=lt({type:s,tooltip:"角色动画组件"}),_=lt({tooltip:"机枪待机动画名称"}),A=lt({tooltip:"机枪移动动画名称"}),z=lt({tooltip:"机枪待机攻击动画名称"}),T=lt({tooltip:"机枪移动攻击动画名称"}),k=lt({tooltip:"攻击范围"}),C=lt({tooltip:"攻击伤害"}),R=lt({tooltip:"移动速度"}),V=lt({type:u,tooltip:"子弹预制体"}),F=lt({type:c,tooltip:"子弹发射点（不填则用自身位置）"}),M=lt({type:c,tooltip:"子弹挂载父节点（不填则用当前节点父节点）"}),W=lt({tooltip:"子弹速度"}),E=lt({tooltip:"子弹存活时间（秒）"}),L=lt({type:c,tooltip:"NPC等待位置节点（没有敌人时会移动到此位置等待）"}),K=lt({tooltip:"到达等待位置的判定距离（米）"}),D=lt({type:u,tooltip:"子弹发射特效预制体（由VFXManager管理）"}),N=lt({tooltip:"子弹发射特效持续时间（秒），到时自动回收"}),U=lt({tooltip:"子弹对象池key（如果使用对象池生成子弹，需要填写此key）"}),w((B=i((I=function(t){function i(){for(var i,e=arguments.length,r=new Array(e),l=0;l<e;l++)r[l]=arguments[l];return i=t.call.apply(t,[this].concat(r))||this,n(i,"anim",B,o(i)),n(i,"idleAnim",x,o(i)),n(i,"moveAnim",X,o(i)),n(i,"attackAnim",O,o(i)),n(i,"runAttackAnim",j,o(i)),n(i,"attackRange",q,o(i)),n(i,"attackDamage",H,o(i)),n(i,"speed",Q,o(i)),n(i,"bulletPrefab",Y,o(i)),n(i,"firePoint",G,o(i)),n(i,"bulletRoot",J,o(i)),n(i,"bulletSpeed",Z,o(i)),n(i,"bulletLifeTime",$,o(i)),n(i,"waitPosition",tt,o(i)),n(i,"arrivalDistance",it,o(i)),n(i,"bulletFireEffectPrefab",et,o(i)),n(i,"bulletFireEffectLifeTime",nt,o(i)),n(i,"bulletPoolKey",ot,o(i)),i.poolKey="",i._isMoving=!1,i._currentAnim="",i._currentTarget=null,i._targetWaitPosition=null,i._rb=null,i}e(i,t);var l=i.prototype;return l.onEnable=function(){var t;this._isMoving=!1,this._currentAnim="",this._currentTarget=null,this.anim||(this.anim=this.getComponent(s)),this._rb=this.getComponent(b),this._rb&&(this._rb.type=b.Type.DYNAMIC,this._rb.allowSleep=!1,this._rb.linearFactor=new f(1,0,1),this._rb.angularFactor=new f(0,1,0)),null!=(t=this.waitPosition)&&t.isValid&&(this._targetWaitPosition=this.waitPosition.worldPosition.clone()),this.playIdleAnim()},l.start=function(){this.bulletPoolKey&&this.bulletPoolKey.length>0&&this.bulletPrefab&&y.getInstance().registerPrefab(this.bulletPoolKey,this.bulletPrefab)},l.update=function(t){var i=this.node.worldPosition,e=this.findNearestEnemy(i);e?(this.stopMoving(),this.playAnim(e,this._isMoving)):(this.moveToWaitPosition(t),this.playAnim(!1,this._isMoving))},l.findNearestEnemy=function(t){for(var i,e=Number.MAX_VALUE,n=this.attackRange*this.attackRange,o=r(d.enemies);!(i=o()).done;){var l,a=i.value;if(null!=(l=a.node)&&l.active&&!a.isDead){var s=f.distance(t,a.node.worldPosition),u=s*s;u<e&&(e=u,this._currentTarget=a.node)}}var c=null!==this._currentTarget&&e<=n;return c&&this.rotateToTarget(this._currentTarget.worldPosition,t),c},l.rotateToTarget=function(t,i){var e=new f;if(f.subtract(e,t,i),e.y=0,e.lengthSqr()>.001){e.normalize();var n=new h;h.fromViewUp(n,e,f.UP);var o=new h;h.slerp(o,this.node.worldRotation,n,.2),this.node.setWorldRotation(o)}},l.stopMoving=function(){if(this._rb){var t=new f;this._rb.getLinearVelocity(t),t.x=0,t.z=0,this._rb.setLinearVelocity(t)}this._isMoving=!1},l.moveToWaitPosition=function(t){var i;if(null!=(i=this.waitPosition)&&i.isValid){this._targetWaitPosition||(this._targetWaitPosition=this.waitPosition.worldPosition.clone());var e=this.node.worldPosition,n=this.waitPosition.worldPosition.clone(),o=new f;if(f.subtract(o,n,e),o.y=0,o.length()<=this.arrivalDistance){this.stopMoving();var r=new h;return this.waitPosition.getWorldRotation(r),void this.node.setWorldRotation(r)}if(o.lengthSqr()>.001){o.normalize();var l=new h;h.fromViewUp(l,o,f.UP);var a=new h;h.slerp(a,this.node.worldRotation,l,.2),this.node.setWorldRotation(a)}if(this._isMoving=!0,this._rb){var s=new f;this._rb.getLinearVelocity(s),s.x=o.x*this.speed,s.z=o.z*this.speed,this._rb.setLinearVelocity(s)}else{var u=this.speed*t,c=new f;f.scaleAndAdd(c,e,o,u),c.y=e.y,this.node.setWorldPosition(c)}}else this.stopMoving()},l.playAnim=function(t,i){var e="";(e=t?i?this.runAttackAnim:this.attackAnim:i?this.moveAnim:this.idleAnim)&&this._currentAnim!==e&&this.anim&&(this._currentAnim=e,this.anim.crossFade(e,.3))},l.playIdleAnim=function(){this.idleAnim&&this.playAnim(!1,!1)},l.fireBullet=function(t){var i;if(this.bulletPrefab){var e=(null==(i=this.firePoint)?void 0:i.worldPosition)||this.node.worldPosition,n=new f(0,0,1);if(t?(f.subtract(n,t.worldPosition,e),n.y=0):(f.transformQuat(n,new f(0,0,1),this.node.worldRotation),n.y=0),n.lengthSqr()>1e-4?n.normalize():n.set(0,0,1),this.bulletFireEffectPrefab){var o=new h;h.fromViewUp(o,n,f.UP),P.getInstance().playVFX(this.bulletFireEffectPrefab,e,o,this.bulletRoot||this.node.parent||this.node,!0,this.bulletFireEffectLifeTime)}var r=null,l=this.bulletRoot||this.node.parent||this.node;if(this.bulletPoolKey&&this.bulletPoolKey.length>0){r=y.getInstance().get(this.bulletPoolKey,l)}else{if(!this.bulletPrefab)return;(r=p(this.bulletPrefab)).parent=l}if(r){r.setWorldPosition(e);var a=new h;h.fromViewUp(a,n,f.UP),r.setWorldRotation(a);var s=r.getComponent(g);s&&(s.speed=this.bulletSpeed,s.lifeTime=this.bulletLifeTime,s.damage=this.attackDamage,this.bulletPoolKey&&this.bulletPoolKey.length>0&&(s.poolKey=this.bulletPoolKey),s.setDirection(n))}else console.warn("NPCController: 无法创建子弹节点")}},l.onAttackEvent=function(t){this.fireBullet(this._currentTarget)},l.setWaitPosition=function(t){if(t instanceof c)this.waitPosition=t,null!=t&&t.isValid&&(this._targetWaitPosition=t.worldPosition.clone());else if(t instanceof f){var i;this._targetWaitPosition=t.clone(),null!=(i=this.waitPosition)&&i.isValid&&this.waitPosition.setWorldPosition(t)}},i}(m)).prototype,"anim",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=i(I.prototype,"idleAnim",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"idle"}}),X=i(I.prototype,"moveAnim",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"run"}}),O=i(I.prototype,"attackAnim",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"attack"}}),j=i(I.prototype,"runAttackAnim",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"runattack"}}),q=i(I.prototype,"attackRange",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 6}}),H=i(I.prototype,"attackDamage",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),Q=i(I.prototype,"speed",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Y=i(I.prototype,"bulletPrefab",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=i(I.prototype,"firePoint",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=i(I.prototype,"bulletRoot",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=i(I.prototype,"bulletSpeed",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),$=i(I.prototype,"bulletLifeTime",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),tt=i(I.prototype,"waitPosition",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),it=i(I.prototype,"arrivalDistance",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),et=i(I.prototype,"bulletFireEffectPrefab",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nt=i(I.prototype,"bulletFireEffectLifeTime",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ot=i(I.prototype,"bulletPoolKey",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),S=I))||S));l._RF.pop()}}}));

System.register("chunks:///_virtual/ObjectPool.ts",["cc"],(function(t){var o,s,e;return{setters:[function(t){o=t.cclegacy,s=t._decorator,e=t.instantiate}],execute:function(){o._RF.push({},"1d180z84rFEJLnshU5C5l+D","ObjectPool",void 0);s.ccclass;t("ObjectPool",function(){function t(){this._pools=new Map,this._prefabs=new Map,this._poolRoot=null}t.getInstance=function(){return t._instance||(t._instance=new t),t._instance};var o=t.prototype;return o.setPoolRoot=function(t){this._poolRoot=t},o.registerPrefab=function(t,o){this._prefabs.set(t,o),this._pools.has(t)||this._pools.set(t,[])},o.get=function(t,o){var s=this._prefabs.get(t);if(!s)return null;var i=this._pools.get(t);i||(i=[],this._pools.set(t,i));for(var n=null,a=i.length-1;a>=0;a--){var r=i[a];if(r&&r.isValid){i.splice(a,1),n=r;break}i.splice(a,1)}n||(n=e(s)),o?(o.isValid&&!o.active&&(o.active=!0),n.parent=o):this._poolRoot&&(this._poolRoot.isValid&&!this._poolRoot.active&&(this._poolRoot.active=!0),n.parent=this._poolRoot);try{n.active||(n.active=!0)}catch(t){}return n},o.put=function(t,o){if(o&&o.isValid){var s=this._pools.get(t);s||(s=[],this._pools.set(t,s)),s.indexOf(o)>=0||(o.active=!1,this._poolRoot&&(o.parent=this._poolRoot),s.push(o))}},o.preload=function(t,o,s){var i=this._prefabs.get(t);if(i){var n=this._pools.get(t);n||(n=[],this._pools.set(t,n));for(var a=0;a<o;a++){var r=e(i);r.active=!1,s?r.parent=s:this._poolRoot&&(r.parent=this._poolRoot),n.push(r)}}},o.clear=function(t){if(t){var o=this._pools.get(t);o&&(o.forEach((function(t){t&&t.isValid&&t.destroy()})),o.length=0)}else this._pools.forEach((function(t){t.forEach((function(t){t&&t.isValid&&t.destroy()})),t.length=0})),this._pools.clear(),this._prefabs.clear()},o.getPoolSize=function(t){var o=this._pools.get(t);return o?o.length:0},o.isRegistered=function(t){return this._prefabs.has(t)},t}())._instance=null,o._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Joystick.ts","./EnemyController.ts","./BulletController.ts","./GoldController.ts","./VFXManager.ts","./ObjectPool.ts"],(function(t){var e,i,n,a,o,r,l,s,c,u,p,h,f,m,g,d,b,A,y,_,w,k,G,v,P;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,a=t.assertThisInitialized,o=t.createForOfIteratorHelperLoose},function(t){r=t.cclegacy,l=t._decorator,s=t.SkeletalAnimation,c=t.Enum,u=t.Prefab,p=t.Node,h=t.Vec3,f=t.Quat,m=t.RigidBody,g=t.instantiate,d=t.randomRange,b=t.find,A=t.director,y=t.Component},function(t){_=t.Joystick},function(t){w=t.EnemyController},function(t){k=t.BulletController},function(t){G=t.GoldController},function(t){v=t.VFXManager},function(t){P=t.ObjectPool}],execute:function(){var z,R,M,I,T,N,W,D,B,E,S,C,V,O,L,U,H,F,x,K,X,q,j,Y,Z,Q,J,$,tt,et,it,nt,at,ot,rt,lt,st,ct,ut,pt,ht,ft,mt,gt,dt,bt,At,yt,_t,wt,kt,Gt,vt,Pt,zt,Rt,Mt,It,Tt,Nt,Wt,Dt,Bt,Et,St,Ct,Vt,Ot,Lt,Ut,Ht,Ft,xt,Kt,Xt,qt,jt,Yt,Zt,Qt,Jt,$t,te,ee,ie,ne,ae,oe,re,le,se,ce,ue,pe,he,fe,me,ge,de,be,Ae,ye,_e,we,ke,Ge,ve,Pe,ze,Re,Me,Ie,Te,Ne,We;r._RF.push({},"f30b9l1T7pKHIiAyJ1lUckt","PlayerController",void 0);var De=l.ccclass,Be=l.property,Ee=t("WeaponType",function(t){return t[t.CHAINSAW=0]="CHAINSAW",t[t.PISTOL=1]="PISTOL",t[t.MACHINE_GUN=2]="MACHINE_GUN",t[t.GATLING_GUN=3]="GATLING_GUN",t}({}));t("PlayerController",(z=De("PlayerController"),R=Be({type:_,tooltip:"摇杆组件引用"}),M=Be({type:s,tooltip:"角色动画组件"}),I=Be({type:c(Ee),tooltip:"当前武器类型"}),T=Be({tooltip:"电锯待机动画名称"}),N=Be({tooltip:"电锯移动动画名称"}),W=Be({tooltip:"电锯待机攻击动画名称"}),D=Be({tooltip:"电锯移动攻击动画名称"}),B=Be({tooltip:"电锯攻击范围"}),E=Be({tooltip:"电锯攻击伤害"}),S=Be({type:u,tooltip:"电锯攻击特效预制体"}),C=Be({tooltip:"电锯攻击特效旋转偏移X（度）"}),V=Be({tooltip:"电锯攻击特效旋转偏移Y（度）"}),O=Be({tooltip:"电锯攻击特效旋转偏移Z（度）"}),L=Be({tooltip:"手枪待机动画名称"}),U=Be({tooltip:"手枪移动动画名称"}),H=Be({tooltip:"手枪待机攻击动画名称"}),F=Be({tooltip:"手枪移动攻击动画名称"}),x=Be({tooltip:"手枪攻击范围"}),K=Be({tooltip:"手枪攻击伤害"}),X=Be({tooltip:"机枪待机动画名称"}),q=Be({tooltip:"机枪移动动画名称"}),j=Be({tooltip:"机枪待机攻击动画名称"}),Y=Be({tooltip:"机枪移动攻击动画名称"}),Z=Be({tooltip:"机枪攻击范围"}),Q=Be({tooltip:"机枪攻击伤害"}),J=Be({tooltip:"机关枪待机动画名称"}),$=Be({tooltip:"机关枪移动动画名称"}),tt=Be({tooltip:"机关枪待机攻击动画名称"}),et=Be({tooltip:"机关枪移动攻击动画名称"}),it=Be({tooltip:"机关枪攻击范围"}),nt=Be({tooltip:"机关枪攻击伤害"}),at=Be({tooltip:"加特林子弹角度偏移范围（度），例如：5 表示 -5 到 5 度的随机偏移"}),ot=Be({tooltip:"移动速度"}),rt=Be({type:u,tooltip:"子弹预制体"}),lt=Be({tooltip:"子弹对象池key（如果使用对象池生成子弹，需要填写此key）"}),st=Be({type:p,tooltip:"手枪子弹挂载父节点（不填则用当前节点父节点）"}),ct=Be({type:p,tooltip:"机枪子弹挂载父节点（不填则用当前节点父节点）"}),ut=Be({type:p,tooltip:"机关枪子弹挂载父节点（不填则用当前节点父节点）"}),pt=Be({type:u,tooltip:"手枪枪口火焰特效预制体"}),ht=Be({type:u,tooltip:"机枪枪口火焰特效预制体"}),ft=Be({type:u,tooltip:"机关枪枪口火焰特效预制体"}),mt=Be({tooltip:"子弹速度"}),gt=Be({tooltip:"子弹存活时间（秒）"}),dt=Be({tooltip:"金币吸收范围"}),bt=Be({tooltip:"背包位置偏移距离（主角背后的距离）"}),At=Be({tooltip:"金币堆叠间隔（每个金币之间的高度偏移）"}),yt=Be({type:u,tooltip:"主角升级特效预制体（武器升级时播放，跟随主角移动）"}),_t=Be({tooltip:"主角升级特效持续时间（秒）"}),wt=Be({type:u,tooltip:"指引预制体"}),kt=Be({tooltip:"指引生成间隔"}),Gt=Be({tooltip:"指引高度偏移"}),vt=Be({tooltip:"指引移动速度"}),Pt=Be({type:p,tooltip:"电锯武器网格体节点（骨骼网格体）"}),zt=Be({type:p,tooltip:"手枪武器网格体节点（骨骼网格体）"}),Rt=Be({type:p,tooltip:"机关枪武器网格体节点（骨骼网格体）"}),Mt=Be({type:p,tooltip:"加特林武器网格体节点（骨骼网格体）"}),z((Nt=e((Tt=function(t){function e(){for(var e,i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return e=t.call.apply(t,[this].concat(o))||this,n(e,"joystick",Nt,a(e)),n(e,"anim",Wt,a(e)),n(e,"currentWeaponType",Dt,a(e)),n(e,"chainsawIdleAnim",Bt,a(e)),n(e,"chainsawMoveAnim",Et,a(e)),n(e,"chainsawAttackAnim",St,a(e)),n(e,"chainsawRunAttackAnim",Ct,a(e)),n(e,"chainsawAttackRange",Vt,a(e)),n(e,"chainsawAttackDamage",Ot,a(e)),n(e,"chainsawAttackEffectPrefab",Lt,a(e)),n(e,"chainsawAttackEffectRotationOffsetX",Ut,a(e)),n(e,"chainsawAttackEffectRotationOffsetY",Ht,a(e)),n(e,"chainsawAttackEffectRotationOffsetZ",Ft,a(e)),n(e,"pistolIdleAnim",xt,a(e)),n(e,"pistolMoveAnim",Kt,a(e)),n(e,"pistolAttackAnim",Xt,a(e)),n(e,"pistolRunAttackAnim",qt,a(e)),n(e,"pistolAttackRange",jt,a(e)),n(e,"pistolAttackDamage",Yt,a(e)),n(e,"machineGunIdleAnim",Zt,a(e)),n(e,"machineGunMoveAnim",Qt,a(e)),n(e,"machineGunAttackAnim",Jt,a(e)),n(e,"machineGunRunAttackAnim",$t,a(e)),n(e,"machineGunAttackRange",te,a(e)),n(e,"machineGunAttackDamage",ee,a(e)),n(e,"gatlingGunIdleAnim",ie,a(e)),n(e,"gatlingGunMoveAnim",ne,a(e)),n(e,"gatlingGunAttackAnim",ae,a(e)),n(e,"gatlingGunRunAttackAnim",oe,a(e)),n(e,"gatlingGunAttackRange",re,a(e)),n(e,"gatlingGunAttackDamage",le,a(e)),n(e,"gatlingGunAngleOffsetRange",se,a(e)),n(e,"speed",ce,a(e)),n(e,"bulletPrefab",ue,a(e)),n(e,"bulletPoolKey",pe,a(e)),n(e,"pistolBulletRoot",he,a(e)),n(e,"machineGunBulletRoot",fe,a(e)),n(e,"gatlingGunBulletRoot",me,a(e)),n(e,"pistolMuzzleFlashEffectPrefab",ge,a(e)),n(e,"machineGunMuzzleFlashEffectPrefab",de,a(e)),n(e,"gatlingGunMuzzleFlashEffectPrefab",be,a(e)),n(e,"bulletSpeed",Ae,a(e)),n(e,"bulletLifeTime",ye,a(e)),n(e,"goldCollectRange",_e,a(e)),n(e,"backpackOffset",we,a(e)),n(e,"goldStackSpacing",ke,a(e)),n(e,"upgradeEffectPrefab",Ge,a(e)),n(e,"upgradeEffectLifeTime",ve,a(e)),n(e,"guidePrefab",Pe,a(e)),n(e,"guideInterval",ze,a(e)),n(e,"guideHeight",Re,a(e)),n(e,"guideSpeed",Me,a(e)),n(e,"chainsawWeaponMesh",Ie,a(e)),n(e,"pistolWeaponMesh",Te,a(e)),n(e,"machineGunWeaponMesh",Ne,a(e)),n(e,"gatlingGunWeaponMesh",We,a(e)),e._guideNodes=[],e._guideOffset=0,e._guideTarget=null,e._isMoving=!1,e._currentAnim="",e._collectedGolds=[],e._tempVelocity=new h,e._tempMoveDir=new h,e._tempTargetDir=new h,e._zeroVelocity=new h(0,0,0),e._zeroAngularVelocity=new h(0,0,0),e._tempMoveVec=new h,e._tempTargetRot=new f,e._tempCurrentRot=new f,e._tempNextRot=new f,e._tempForward=new h(0,0,-1),e._tempBackward=new h,e._tempBackpackPos=new h,e._tempEnemyDir=new h,e._tempBulletDir=new h,e._tempBulletRot=new f,e._tempStartPos=new h,e._tempTargetPos=new h,e._tempDistVec=new h,e._tempGuidePos=new h,e._linearFactor=new h(1,0,1),e._angularFactor=new h(0,1,0),e}i(e,t);var r=e.prototype;return r.start=function(){this.anim||(this.anim=this.getComponent(s)),this.playIdleAnim();var t=this.getComponent(m);(t&&(t.type=m.Type.DYNAMIC,t.allowSleep=!1,t.linearFactor=this._linearFactor,t.angularFactor=this._angularFactor,t.setLinearVelocity(this._zeroVelocity),t.setAngularVelocity(this._zeroAngularVelocity)),this.bulletPoolKey&&this.bulletPoolKey.length>0&&this.bulletPrefab)&&P.getInstance().registerPrefab(this.bulletPoolKey,this.bulletPrefab);this.updateWeaponMeshVisibility()},r.update=function(t){for(var e,i=null,n=Number.MAX_VALUE,a=this.node.worldPosition,r=w.enemies,l=o(r);!(e=l()).done;){var s=e.value;if(s.node&&s.node.active&&!s.isDead){h.subtract(this._tempEnemyDir,s.node.worldPosition,a);var c=this._tempEnemyDir.lengthSqr();c<n&&(n=c,i=s.node)}}var u=this.joystick||_.instance,p=u&&(0!==u.direction.x||0!==u.direction.y),g=this.getComponent(m);if(p){var d=u.direction.x,b=-u.direction.y;if(this._tempMoveDir.set(d,0,b),this._tempMoveDir.normalize(),g)g.getLinearVelocity(this._tempVelocity),this._tempVelocity.x=this._tempMoveDir.x*this.speed,this._tempVelocity.z=this._tempMoveDir.z*this.speed,g.setLinearVelocity(this._tempVelocity);else{h.multiplyScalar(this._tempMoveVec,this._tempMoveDir,this.speed*t);var A=this.node.position;this.node.setPosition(A.x+this._tempMoveVec.x,A.y,A.z+this._tempMoveVec.z)}this._isMoving=!0;var y=this.getAttackRange();i&&n<=y*y?this.playRunAttackAnim():this.playMoveAnim()}else this._isMoving=!1,g&&(g.setLinearVelocity(this._zeroVelocity),g.setAngularVelocity(this._zeroAngularVelocity));var k=this.getAttackRange();if(i&&n<=k*k?(h.subtract(this._tempTargetDir,i.worldPosition,a),this._tempTargetDir.y=0):p?this._tempTargetDir.set(u.direction.x,0,-u.direction.y):this._tempTargetDir.set(0,0,0),this._tempTargetDir.lengthSqr()>.001?(this._tempTargetDir.normalize(),f.fromViewUp(this._tempTargetRot,this._tempTargetDir,h.UP),this.node.getWorldRotation(this._tempCurrentRot),f.slerp(this._tempNextRot,this._tempCurrentRot,this._tempTargetRot,.2),this.node.setWorldRotation(this._tempNextRot)):g&&g.setAngularVelocity(this._zeroAngularVelocity),!this._isMoving&&i){var G=this.getAttackRange();n<=G*G?this.playAttackAnim():this.playIdleAnim()}else this._isMoving||this.playIdleAnim();this.collectGold(),this.updateBackpackGolds(t),this.updateGuide(t)},r.playAnim=function(t){this._currentAnim!==t&&(this._currentAnim=t,this.anim&&this.anim.crossFade(t,.3))},r.playIdleAnim=function(){var t="";switch(this.currentWeaponType){case Ee.CHAINSAW:t=this.chainsawIdleAnim;break;case Ee.PISTOL:t=this.pistolIdleAnim;break;case Ee.MACHINE_GUN:t=this.machineGunIdleAnim;break;case Ee.GATLING_GUN:t=this.gatlingGunIdleAnim}t&&this.playAnim(t)},r.playMoveAnim=function(){var t="";switch(this.currentWeaponType){case Ee.CHAINSAW:t=this.chainsawMoveAnim;break;case Ee.PISTOL:t=this.pistolMoveAnim;break;case Ee.MACHINE_GUN:t=this.machineGunMoveAnim;break;case Ee.GATLING_GUN:t=this.gatlingGunMoveAnim}t&&this.playAnim(t)},r.playAttackAnim=function(){var t="";switch(this.currentWeaponType){case Ee.CHAINSAW:t=this.chainsawAttackAnim;break;case Ee.PISTOL:t=this.pistolAttackAnim;break;case Ee.MACHINE_GUN:t=this.machineGunAttackAnim;break;case Ee.GATLING_GUN:t=this.gatlingGunAttackAnim}t&&this.playAnim(t)},r.playRunAttackAnim=function(){var t="";switch(this.currentWeaponType){case Ee.CHAINSAW:t=this.chainsawRunAttackAnim;break;case Ee.PISTOL:t=this.pistolRunAttackAnim;break;case Ee.MACHINE_GUN:t=this.machineGunRunAttackAnim;break;case Ee.GATLING_GUN:t=this.gatlingGunRunAttackAnim}t&&this.playAnim(t)},r.getAttackRange=function(){switch(this.currentWeaponType){case Ee.CHAINSAW:return this.chainsawAttackRange;case Ee.PISTOL:return this.pistolAttackRange;case Ee.MACHINE_GUN:return this.machineGunAttackRange;case Ee.GATLING_GUN:return this.gatlingGunAttackRange;default:return.5}},r.getAttackDamage=function(){switch(this.currentWeaponType){case Ee.CHAINSAW:return this.chainsawAttackDamage;case Ee.PISTOL:return this.pistolAttackDamage;case Ee.MACHINE_GUN:return this.machineGunAttackDamage;case Ee.GATLING_GUN:return this.gatlingGunAttackDamage;default:return 50}},r.isRangedWeapon=function(){return this.currentWeaponType!==Ee.CHAINSAW},r.getCurrentBulletRoot=function(){var t=null;switch(this.currentWeaponType){case Ee.PISTOL:t=this.pistolBulletRoot;break;case Ee.MACHINE_GUN:t=this.machineGunBulletRoot;break;case Ee.GATLING_GUN:t=this.gatlingGunBulletRoot;break;case Ee.CHAINSAW:}return t||this.node.parent},r.switchWeapon=function(t){if(this.currentWeaponType!==t){if(this.currentWeaponType=t,this.updateWeaponMeshVisibility(),this.upgradeEffectPrefab){var e=v.getInstance(),i=this.node.worldPosition.clone(),n=e.playVFX(this.upgradeEffectPrefab,i,null,this.node,!0,this.upgradeEffectLifeTime);n&&n.isValid&&this.node.isValid&&(n.parent!==this.node&&(n.parent=this.node),n.setPosition(0,0,0))}this._isMoving?this.playMoveAnim():this.playIdleAnim()}},r.updateWeaponMeshVisibility=function(){var t=null;switch(this.currentWeaponType){case Ee.CHAINSAW:t=this.chainsawWeaponMesh;break;case Ee.PISTOL:t=this.pistolWeaponMesh;break;case Ee.MACHINE_GUN:t=this.machineGunWeaponMesh;break;case Ee.GATLING_GUN:t=this.gatlingGunWeaponMesh}this.chainsawWeaponMesh&&(this.chainsawWeaponMesh.active=this.chainsawWeaponMesh===t),this.pistolWeaponMesh&&(this.pistolWeaponMesh.active=this.pistolWeaponMesh===t),this.machineGunWeaponMesh&&(this.machineGunWeaponMesh.active=this.machineGunWeaponMesh===t),this.gatlingGunWeaponMesh&&(this.gatlingGunWeaponMesh.active=this.gatlingGunWeaponMesh===t)},r.fireBullet=function(t){if(this.bulletPrefab){var e=this.getCurrentBulletRoot(),i=null;switch(this.currentWeaponType){case Ee.PISTOL:i=this.pistolBulletRoot;break;case Ee.MACHINE_GUN:i=this.machineGunBulletRoot;break;case Ee.GATLING_GUN:i=this.gatlingGunBulletRoot}var n=i?i.worldPosition:this.node.worldPosition;if(t){var a=t.worldPosition;h.subtract(this._tempBulletDir,a,n),this._tempBulletDir.y=0}else h.transformQuat(this._tempBulletDir,this._tempForward,this.node.worldRotation),this._tempBulletDir.y=0;this._tempBulletDir.lengthSqr()>1e-4?this._tempBulletDir.normalize():this._tempBulletDir.set(0,0,-1);var o=null;if(this.bulletPoolKey&&this.bulletPoolKey.length>0){o=P.getInstance().get(this.bulletPoolKey,e)}else{if(!this.bulletPrefab)return;(o=g(this.bulletPrefab)).parent=e}if(o){o.setWorldPosition(n);var r=o.getComponent(k);if(r){r.speed=this.bulletSpeed,r.lifeTime=this.bulletLifeTime,r.damage=this.getAttackDamage(),this.bulletPoolKey&&this.bulletPoolKey.length>0&&(r.poolKey=this.bulletPoolKey);var l=void 0;this.currentWeaponType===Ee.GATLING_GUN&&this.gatlingGunAngleOffsetRange>0&&(l=d(-this.gatlingGunAngleOffsetRange,this.gatlingGunAngleOffsetRange)),r.setDirection(this._tempBulletDir,l),(!l||Math.abs(l)<.001)&&(f.fromViewUp(this._tempBulletRot,this._tempBulletDir,h.UP),o.setWorldRotation(this._tempBulletRot))}this.playMuzzleFlash(n,i)}else console.warn("PlayerController: 无法创建子弹节点")}},r.playMuzzleFlash=function(t,e){var i=null;switch(this.currentWeaponType){case Ee.PISTOL:i=this.pistolMuzzleFlashEffectPrefab;break;case Ee.MACHINE_GUN:i=this.machineGunMuzzleFlashEffectPrefab;break;case Ee.GATLING_GUN:i=this.gatlingGunMuzzleFlashEffectPrefab}if(i){f.fromViewUp(this._tempBulletRot,this._tempBulletDir,h.UP);var n=e||this.node,a=v.getInstance();if(a){var o=a.playVFX(i,t,this._tempBulletRot,n,!0,.1);o&&o.isValid&&e&&e.isValid&&(o.parent!==e&&(o.parent=e),o.setPosition(0,0,0))}}},r.collectGold=function(){for(var t,e=this.node.worldPosition,i=this.goldCollectRange*this.goldCollectRange,n=G.golds,a=o(n);!(t=a()).done;){var r=t.value;if(r.node&&r.node.active&&!r.isCollected&&r.canBeCollected){var l=r.node.worldPosition;if(h.subtract(this._tempEnemyDir,l,e),this._tempEnemyDir.lengthSqr()<=i){h.transformQuat(this._tempBackward,this._tempForward,this.node.worldRotation),this._tempBackward.y=0,this._tempBackward.normalize(),this._tempBackward.multiplyScalar(-1),this._tempBackward.multiplyScalar(this.backpackOffset);var s=this._collectedGolds.length;this._tempBackpackPos.set(e.x+this._tempBackward.x,e.y+s*this.goldStackSpacing,e.z+this._tempBackward.z),r.collectToBackpack(this._tempBackpackPos),this._collectedGolds.push(r.node)}}}},r.updateBackpackGolds=function(t){var e=this.node.worldPosition;h.transformQuat(this._tempBackward,this._tempForward,this.node.worldRotation),this._tempBackward.y=0,this._tempBackward.normalize(),this._tempBackward.multiplyScalar(-1),this._tempBackward.multiplyScalar(this.backpackOffset);for(var i=0;i<this._collectedGolds.length;i++){var n=this._collectedGolds[i];if(n&&n.isValid&&n.active){var a=n.getComponent(G);a&&(this._tempBackpackPos.set(e.x+this._tempBackward.x,e.y+i*this.goldStackSpacing,e.z+this._tempBackward.z),a.isAnimating?a.updateAnimation(t,this._tempBackpackPos):n.setWorldPosition(this._tempBackpackPos))}else this._collectedGolds.splice(i,1),i--}},r.getCollectedGolds=function(){return this._collectedGolds.slice()},r.removeCollectedGold=function(t){var e=this._collectedGolds.indexOf(t);return e>=0&&(this._collectedGolds.splice(e,1),!0)},r.onAttackEvent=function(t){t||(t=this.isRangedWeapon()?"ranged":"melee"),"melee"===t?this.performMeleeAttack():"ranged"===t&&this.performRangedAttack()},r.performMeleeAttack=function(){var t=this.node.worldPosition,e=this.getAttackRange(),i=e*e,n=w.enemies;if(this.currentWeaponType===Ee.CHAINSAW&&this.chainsawAttackEffectPrefab){var a=new f;this.node.getWorldRotation(a);var r=a,l=Math.abs(this.chainsawAttackEffectRotationOffsetX)>.001,s=Math.abs(this.chainsawAttackEffectRotationOffsetY)>.001,c=Math.abs(this.chainsawAttackEffectRotationOffsetZ)>.001;if(l||s||c){var u=new f;if(f.identity(u),l){var p=new f,m=this.chainsawAttackEffectRotationOffsetX*Math.PI/180;f.fromAxisAngle(p,h.RIGHT,m),f.multiply(u,u,p)}if(s){var g=new f,d=this.chainsawAttackEffectRotationOffsetY*Math.PI/180;f.fromAxisAngle(g,h.UP,d),f.multiply(u,u,g)}if(c){var b=new f,A=this.chainsawAttackEffectRotationOffsetZ*Math.PI/180;f.fromAxisAngle(b,h.FORWARD,A),f.multiply(u,u,b)}r=new f,f.multiply(r,a,u)}v.getInstance().playVFX(this.chainsawAttackEffectPrefab,t,r,this.node.parent)}for(var y,_=o(n);!(y=_()).done;){var k=y.value;if(k.node&&k.node.active&&!k.isDead){var G=k.node.worldPosition;h.subtract(this._tempEnemyDir,G,t),this._tempEnemyDir.lengthSqr()<=i&&k.takeDamage(this.getAttackDamage())}}},r.performRangedAttack=function(){for(var t,e=null,i=Number.MAX_VALUE,n=this.node.worldPosition,a=w.enemies,r=this.getAttackRange(),l=r*r,s=o(a);!(t=s()).done;){var c=t.value;if(c.node&&c.node.active&&!c.isDead){h.subtract(this._tempEnemyDir,c.node.worldPosition,n);var u=this._tempEnemyDir.lengthSqr();u<i&&u<=l&&(i=u,e=c.node)}}e?this.fireBullet(e):this.fireBullet(null)},r.updateGuide=function(t){if(this.guidePrefab){if(!(this._guideTarget&&this._guideTarget.isValid&&this._guideTarget.active||(this._guideTarget=b("GoldPlace"),this._guideTarget))){var e=A.getScene();if(e){var i=e.getComponentsInChildren("GoldPlaceController");if(i&&i.length>0)for(var n,a=Number.MAX_VALUE,r=this.node.worldPosition,l=o(i);!(n=l()).done;){var s=n.value;if(s.node&&s.node.active){h.subtract(this._tempEnemyDir,s.node.worldPosition,r);var c=this._tempEnemyDir.lengthSqr();c<a&&(a=c,this._guideTarget=s.node)}}}}if(this._guideTarget&&this._guideTarget.isValid&&this._guideTarget.active){this._tempStartPos.set(this.node.worldPosition),this._tempStartPos.y+=this.guideHeight,this._tempTargetPos.set(this._guideTarget.worldPosition),this._tempTargetPos.y+=this.guideHeight,h.subtract(this._tempDistVec,this._tempTargetPos,this._tempStartPos);var u=this._tempDistVec.length();if(u<.5)this.recycleAllGuideNodes();else{this._tempDistVec.normalize(),this._guideOffset+=this.guideSpeed*t,this._guideOffset>=this.guideInterval&&(this._guideOffset-=this.guideInterval);for(var p=Math.floor((u-this._guideOffset)/this.guideInterval)+1;this._guideNodes.length<p;){var f=g(this.guidePrefab),m=A.getScene();f.parent=m||this.node.parent,this._guideNodes.push(f)}for(var d=0;d<this._guideNodes.length;d++){var y=this._guideNodes[d];if(d<p){y.active||(y.active=!0);var _=this._guideOffset+d*this.guideInterval;h.scaleAndAdd(this._tempGuidePos,this._tempStartPos,this._tempDistVec,_),y.setWorldPosition(this._tempGuidePos),y.lookAt(this._tempTargetPos)}else y.active&&(y.active=!1)}}}else this.recycleAllGuideNodes()}},r.recycleAllGuideNodes=function(){for(var t,e=o(this._guideNodes);!(t=e()).done;){var i=t.value;i.active&&(i.active=!1)}},e}(y)).prototype,"joystick",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wt=e(Tt.prototype,"anim",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Dt=e(Tt.prototype,"currentWeaponType",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ee.CHAINSAW}}),Bt=e(Tt.prototype,"chainsawIdleAnim",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"idle"}}),Et=e(Tt.prototype,"chainsawMoveAnim",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"run"}}),St=e(Tt.prototype,"chainsawAttackAnim",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"attack"}}),Ct=e(Tt.prototype,"chainsawRunAttackAnim",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"runattack"}}),Vt=e(Tt.prototype,"chainsawAttackRange",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Ot=e(Tt.prototype,"chainsawAttackDamage",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),Lt=e(Tt.prototype,"chainsawAttackEffectPrefab",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ut=e(Tt.prototype,"chainsawAttackEffectRotationOffsetX",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ht=e(Tt.prototype,"chainsawAttackEffectRotationOffsetY",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ft=e(Tt.prototype,"chainsawAttackEffectRotationOffsetZ",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xt=e(Tt.prototype,"pistolIdleAnim",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"idle"}}),Kt=e(Tt.prototype,"pistolMoveAnim",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"run"}}),Xt=e(Tt.prototype,"pistolAttackAnim",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"attack"}}),qt=e(Tt.prototype,"pistolRunAttackAnim",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"runattack"}}),jt=e(Tt.prototype,"pistolAttackRange",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Yt=e(Tt.prototype,"pistolAttackDamage",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),Zt=e(Tt.prototype,"machineGunIdleAnim",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"idle"}}),Qt=e(Tt.prototype,"machineGunMoveAnim",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"run"}}),Jt=e(Tt.prototype,"machineGunAttackAnim",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"attack"}}),$t=e(Tt.prototype,"machineGunRunAttackAnim",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"runattack"}}),te=e(Tt.prototype,"machineGunAttackRange",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 6}}),ee=e(Tt.prototype,"machineGunAttackDamage",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),ie=e(Tt.prototype,"gatlingGunIdleAnim",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"idle"}}),ne=e(Tt.prototype,"gatlingGunMoveAnim",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"run"}}),ae=e(Tt.prototype,"gatlingGunAttackAnim",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"attack"}}),oe=e(Tt.prototype,"gatlingGunRunAttackAnim",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"runattack"}}),re=e(Tt.prototype,"gatlingGunAttackRange",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 8}}),le=e(Tt.prototype,"gatlingGunAttackDamage",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),se=e(Tt.prototype,"gatlingGunAngleOffsetRange",[at],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),ce=e(Tt.prototype,"speed",[ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ue=e(Tt.prototype,"bulletPrefab",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pe=e(Tt.prototype,"bulletPoolKey",[lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),he=e(Tt.prototype,"pistolBulletRoot",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fe=e(Tt.prototype,"machineGunBulletRoot",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),me=e(Tt.prototype,"gatlingGunBulletRoot",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ge=e(Tt.prototype,"pistolMuzzleFlashEffectPrefab",[pt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),de=e(Tt.prototype,"machineGunMuzzleFlashEffectPrefab",[ht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),be=e(Tt.prototype,"gatlingGunMuzzleFlashEffectPrefab",[ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ae=e(Tt.prototype,"bulletSpeed",[mt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),ye=e(Tt.prototype,"bulletLifeTime",[gt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),_e=e(Tt.prototype,"goldCollectRange",[dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),we=e(Tt.prototype,"backpackOffset",[bt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),ke=e(Tt.prototype,"goldStackSpacing",[At],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),Ge=e(Tt.prototype,"upgradeEffectPrefab",[yt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ve=e(Tt.prototype,"upgradeEffectLifeTime",[_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),Pe=e(Tt.prototype,"guidePrefab",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ze=e(Tt.prototype,"guideInterval",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Re=e(Tt.prototype,"guideHeight",[Gt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Me=e(Tt.prototype,"guideSpeed",[vt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),Ie=e(Tt.prototype,"chainsawWeaponMesh",[Pt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Te=e(Tt.prototype,"pistolWeaponMesh",[zt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ne=e(Tt.prototype,"machineGunWeaponMesh",[Rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),We=e(Tt.prototype,"gatlingGunWeaponMesh",[Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),It=Tt))||It));r._RF.pop()}}}));

System.register("chunks:///_virtual/PlayerShootMove.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Joystick.ts","./BulletController.ts","./ObjectPool.ts"],(function(e){var t,i,o,n,r,l,a,s,u,p,f,h,c,b,y,m,d;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,o=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){r=e.cclegacy,l=e._decorator,a=e.SkeletalAnimation,s=e.Prefab,u=e.Node,p=e.Vec3,f=e.RigidBody,h=e.instantiate,c=e.Quat,b=e.Component},function(e){y=e.Joystick},function(e){m=e.BulletController},function(e){d=e.ObjectPool}],execute:function(){var P,v,g,_,w,z,M,S,A,x,K,k,F,T,D,R,Y,I,C,O,j,B,L,J,W,q,E,G,N,Q,H;r._RF.push({},"5a1a2Gvi9FGX4ZkQwRd4tF5","PlayerShootMove",void 0);var U=l.ccclass,V=l.property;e("PlayerShootMove",(P=U("PlayerShootMove"),v=V({type:y,tooltip:"摇杆组件引用（不填则使用 Joystick.instance）"}),g=V({type:a,tooltip:"角色动画组件（可选）"}),_=V({tooltip:"待机动画名称"}),w=V({tooltip:"移动动画名称"}),z=V({tooltip:"移动速度"}),M=V({tooltip:"动画Y轴偏移补偿值（用于修正动画导致的Y轴偏移）"}),S=V({type:s,tooltip:"子弹预制体（例如 resources/Perfab/Bullet）"}),A=V({type:u,tooltip:"子弹出生点（不填则用自身位置）"}),x=V({type:u,tooltip:"子弹挂载父节点（不填则用当前节点父节点）"}),K=V({tooltip:"开火间隔（秒）"}),k=V({tooltip:"子弹速度"}),F=V({tooltip:"子弹存活时间（秒）"}),T=V({tooltip:"是否自动开火（不依赖额外按键/按钮）"}),D=V({tooltip:"子弹对象池key（如果使用对象池生成子弹，需要填写此key）"}),P((I=t((Y=function(e){function t(){for(var t,i=arguments.length,r=new Array(i),l=0;l<i;l++)r[l]=arguments[l];return t=e.call.apply(e,[this].concat(r))||this,o(t,"joystick",I,n(t)),o(t,"anim",C,n(t)),o(t,"idleAnim",O,n(t)),o(t,"moveAnim",j,n(t)),o(t,"moveSpeed",B,n(t)),o(t,"animationYOffset",L,n(t)),o(t,"bulletPrefab",J,n(t)),o(t,"firePoint",W,n(t)),o(t,"bulletRoot",q,n(t)),o(t,"fireInterval",E,n(t)),o(t,"bulletSpeed",G,n(t)),o(t,"bulletLifeTime",N,n(t)),o(t,"autoFire",Q,n(t)),o(t,"bulletPoolKey",H,n(t)),t._isMoving=!1,t._fixedY=0,t._fireTimer=0,t._aimDir=new p(0,0,-1),t}i(t,e);var r=t.prototype;return r.start=function(){this.anim||(this.anim=this.getComponent(a)),this.playAnim(this.idleAnim),this._fixedY=this.node.position.y+this.animationYOffset;var e=this.getComponent(f);(e&&(e.type=f.Type.KINEMATIC),this.bulletPoolKey&&this.bulletPoolKey.length>0&&this.bulletPrefab)&&d.getInstance().registerPrefab(this.bulletPoolKey,this.bulletPrefab)},r.update=function(e){this.updateMove(e),this.updateFire(e)},r.lateUpdate=function(){var e=this.node.position,t=this._fixedY;Math.abs(e.y-t)>1e-4&&this.node.setPosition(e.x,t,e.z)},r.updateMove=function(e){var t=this.joystick||y.instance;if(t&&(0!==t.direction.x||0!==t.direction.y)){var i=t.direction.x,o=-t.direction.y,n=new p(i,0,o);n.lengthSqr()>1e-4&&(n.normalize(),this._aimDir.set(n));var r=n.multiplyScalar(this.moveSpeed*e),l=this.node.position;if(this.node.setPosition(l.x+r.x,this._fixedY,l.z+r.z),this._aimDir.lengthSqr()>1e-4){var a=-(180*Math.atan2(this._aimDir.z,this._aimDir.x)/Math.PI)-90;this.node.setRotationFromEuler(0,a,0)}this._isMoving||(this._isMoving=!0,this.playAnim(this.moveAnim))}else{this._isMoving&&(this._isMoving=!1,this.playAnim(this.idleAnim));var s=this.node.position;this.node.setPosition(s.x,this._fixedY,s.z)}},r.updateFire=function(e){this.autoFire&&this.bulletPrefab&&(this._fireTimer+=e,this._fireTimer<this.fireInterval||(this._fireTimer=0,this.fireOnce()))},r.fireOnce=function(){if(this.bulletPrefab){var e=null,t=this.bulletRoot||this.node.parent;if(this.bulletPoolKey&&this.bulletPoolKey.length>0)e=d.getInstance().get(this.bulletPoolKey,t||this.node.parent);else e=h(this.bulletPrefab),t&&(e.parent=t);if(e){var i=this.firePoint?this.firePoint.worldPosition:this.node.worldPosition;e.setWorldPosition(i);var o=new c;this.node.getWorldRotation(o),e.setWorldRotation(o);var n=e.getComponent(m);n&&(n.speed=this.bulletSpeed,n.lifeTime=this.bulletLifeTime,this.bulletPoolKey&&this.bulletPoolKey.length>0&&(n.poolKey=this.bulletPoolKey),n.setDirection(this._aimDir))}else console.warn("PlayerShootMove: 无法创建子弹节点")}},r.playAnim=function(e){this.anim&&this.anim.crossFade(e,.3)},t}(b)).prototype,"joystick",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(Y.prototype,"anim",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(Y.prototype,"idleAnim",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"idle"}}),j=t(Y.prototype,"moveAnim",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"run"}}),B=t(Y.prototype,"moveSpeed",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),L=t(Y.prototype,"animationYOffset",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-.3}}),J=t(Y.prototype,"bulletPrefab",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(Y.prototype,"firePoint",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(Y.prototype,"bulletRoot",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(Y.prototype,"fireInterval",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),G=t(Y.prototype,"bulletSpeed",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),N=t(Y.prototype,"bulletLifeTime",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),Q=t(Y.prototype,"autoFire",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),H=t(Y.prototype,"bulletPoolKey",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),R=Y))||R));r._RF.pop()}}}));

System.register("chunks:///_virtual/RecycleMonitor.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EnemyController.ts","./VFXManager.ts","./ObjectPool.ts"],(function(e){var t,n,o,i,r,c,a,l,s,u,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized,r=e.createForOfIteratorHelperLoose},function(e){c=e.cclegacy,a=e._decorator,l=e.Component},function(e){s=e.EnemyController},function(e){u=e.VFXManager},function(e){h=e.ObjectPool}],execute:function(){var p,y,f,g,v,d,k,m,b;c._RF.push({},"edaa0kGSvdAq6nYPOutXwnY","RecycleMonitor",void 0);var R=a.ccclass,M=a.property;e("RecycleMonitor",(p=R("RecycleMonitor"),y=M({tooltip:"是否启用回收检测"}),f=M({tooltip:"检测间隔（秒）"}),g=M({tooltip:"是否在控制台输出详细信息"}),p((k=t((d=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return t=e.call.apply(e,[this].concat(r))||this,o(t,"enableMonitor",k,i(t)),o(t,"checkInterval",m,i(t)),o(t,"logDetails",b,i(t)),t._timer=0,t}n(t,e);var c=t.prototype;return c.update=function(e){this.enableMonitor&&(this._timer+=e,this._timer>=this.checkInterval&&(this._timer=0,this.checkRecycleStatus()))},c.checkRecycleStatus=function(){var e=this.checkEnemyRecycle(),t=this.checkVFXRecycle();this.logDetails&&(console.log("========== 回收检测报告 =========="),console.log("怪物状态: "+e.details),console.log("特效状态: "+t.details),console.log("===================================")),(e.hasLeak||t.hasLeak)&&(console.warn("⚠️ 检测到可能的回收问题！"),e.hasLeak&&(console.warn("怪物回收异常: "+e.details),console.warn("建议检查: EnemyController.enemies 列表中存在无效引用")),t.hasLeak&&(console.warn("特效回收异常: "+t.details),console.warn("建议检查: VFXManager 是否正常更新，特效生命周期设置是否合理")))},c.checkEnemyRecycle=function(){for(var e,t=s.enemies,n=0,o=0,i=r(t);!(e=i()).done;){var c=e.value;c&&c.node&&c.node.isValid&&c.node.active&&!c.isDead?n++:o++}var a=o>0;return{aliveCount:n,totalInList:t.length,invalidCount:o,hasLeak:a,details:"存活怪物:"+n+" | 列表总数:"+t.length+" | 无效引用:"+o+(a?" ⚠️":"")}},c.checkVFXRecycle=function(){var e=u.getInstance().getActiveVFXCount(),t=e>100;return{activeCount:e,hasLeak:t,details:"活跃特效:"+e+(t?" ⚠️ (可能过多)":"")}},c.getPoolStatus=function(e){return h.getInstance().getPoolSize(e)},c.manualCheck=function(){this.checkRecycleStatus()},t}(l)).prototype,"enableMonitor",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),m=t(d.prototype,"checkInterval",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),b=t(d.prototype,"logDetails",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),v=d))||v));c._RF.pop()}}}));

System.register("chunks:///_virtual/ShellController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EnemyController.ts"],(function(i){var e,t,o,r,n,l,a,s,d,h,p,c,g;return{setters:[function(i){e=i.applyDecoratedDescriptor,t=i.inheritsLoose,o=i.initializerDefineProperty,r=i.assertThisInitialized,n=i.createForOfIteratorHelperLoose},function(i){l=i.cclegacy,a=i._decorator,s=i.Collider,d=i.RigidBody,h=i.Vec3,p=i.Quat,c=i.Component},function(i){g=i.EnemyController}],execute:function(){var y,u,f,_,m,v,x,B,b,w,z,C,V,S,T;l._RF.push({},"dedd85jXeZIaKAC8KCy5pCx","ShellController",void 0);var E=a.ccclass,D=a.property;i("ShellController",(y=E("ShellController"),u=D({tooltip:"初始水平速度（单位/秒）"}),f=D({tooltip:"初始垂直速度（向上，单位/秒）"}),_=D({tooltip:"存活时间（秒），到时自动销毁"}),m=D({tooltip:"爆炸范围"}),v=D({tooltip:"爆炸伤害"}),x=D({tooltip:"炮弹抛物线高度（控制抛物线峰值高度，值越大抛物线越高，目标位置保持不变）"}),y((w=e((b=function(i){function e(){for(var e,t=arguments.length,n=new Array(t),l=0;l<t;l++)n[l]=arguments[l];return e=i.call.apply(i,[this].concat(n))||this,o(e,"horizontalSpeed",w,r(e)),o(e,"verticalSpeed",z,r(e)),o(e,"lifeTime",C,r(e)),o(e,"explosionRange",V,r(e)),o(e,"explosionDamage",S,r(e)),o(e,"arcHeight",T,r(e)),e._timer=0,e._hasExploded=!1,e._rigidBody=null,e._pendingVelocity=null,e._collisionObjectName="",e}t(e,i);var l=e.prototype;return l.onLoad=function(){var i=this.getComponent(s);i&&(i.isTrigger=!0,i.on("onTriggerEnter",this.onTriggerEnter,this)),this._rigidBody=this.getComponent(d),this._rigidBody||(this._rigidBody=this.node.addComponent(d)),this._rigidBody.type=d.Type.DYNAMIC,this._rigidBody.useGravity=!0,this._rigidBody.allowSleep=!1,this._rigidBody.wakeUp()},l.start=function(){this._pendingVelocity&&this._rigidBody&&(this._rigidBody.setLinearVelocity(this._pendingVelocity),this._rigidBody.wakeUp(),this._pendingVelocity=null)},l.onDestroy=function(){var i=this.getComponent(s);i&&i.off("onTriggerEnter",this.onTriggerEnter,this)},l.setInitialVelocityToTarget=function(i,e,t){var o=this.node.worldPosition,r=new h;h.subtract(r,e,o);var n,l,a=Math.sqrt(r.x*r.x+r.z*r.z),s=e.y-o.y,d=9.8,p=this.arcHeight,c=Math.sqrt(19.6*p),g=c*c-19.6*s;if(g<0){var y=Math.sqrt(19.6*(p+Math.max(0,s))),u=y*y-19.6*s;if(u>=0)n=a/((y+Math.sqrt(u))/d),l=y;else n=void 0!==t?t:this.horizontalSpeed,l=c}else{n=a/((c+Math.sqrt(g))/d),l=c}var f=new h(i.x*n,l,i.z*n);this._rigidBody&&this._rigidBody.isValid?(this._rigidBody.setLinearVelocity(f),this._rigidBody.wakeUp()):this._pendingVelocity=f},l.setInitialVelocity=function(i,e,t){var o=void 0!==e?e:this.horizontalSpeed,r=void 0!==t?t:this.verticalSpeed,n=new h(i.x*o,r,i.z*o);this._rigidBody&&this._rigidBody.isValid?(this._rigidBody.setLinearVelocity(n),this._rigidBody.wakeUp()):this._pendingVelocity=n},l.update=function(i){if(!this._hasExploded)if(this._timer+=i,this._timer>=this.lifeTime)this.explode();else if(this._rigidBody){var e=new h;if(this._rigidBody.getLinearVelocity(e),e.lengthSqr()>1e-4){var t=new h;t.set(e).normalize();var o=new p;p.fromViewUp(o,t,h.UP),this.node.setWorldRotation(o)}}},l.onTriggerEnter=function(i){if(!this._hasExploded){var e=i.otherCollider.node;this._collisionObjectName=e.name;var t=e.getComponent(g);t&&t.isDead||this.explode()}},l.explode=function(){if(!this._hasExploded){this._hasExploded=!0;for(var i,e=this.node.worldPosition,t=this.explosionRange*this.explosionRange,o=g.enemies,r=n(o);!(i=r()).done;){var l=i.value;if(l.node&&l.node.active&&!l.isDead){var a=l.node.worldPosition,s=a.x-e.x,d=a.y-e.y,h=a.z-e.z;s*s+d*d+h*h<=t&&l.takeDamage(this.explosionDamage)}}this.node.destroy()}},e}(c)).prototype,"horizontalSpeed",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),z=e(b.prototype,"verticalSpeed",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 8}}),C=e(b.prototype,"lifeTime",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),V=e(b.prototype,"explosionRange",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),S=e(b.prototype,"explosionDamage",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),T=e(b.prototype,"arcHeight",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),B=b))||B));l._RF.pop()}}}));

System.register("chunks:///_virtual/SpawnEnemy.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EnemyController.ts","./ObjectPool.ts"],(function(e){var t,n,i,o,r,a,l,s,p,y,u,m,c,h,f,d,b,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized,r=e.createForOfIteratorHelperLoose},function(e){a=e.cclegacy,l=e._decorator,s=e.Prefab,p=e.Node,y=e.Collider,u=e.instantiate,m=e.Vec3,c=e.BoxCollider,h=e.randomRange,f=e.SphereCollider,d=e.Component},function(e){b=e.EnemyController},function(e){g=e.ObjectPool}],execute:function(){var w,P,v,z,C,x,E,S,K,R,_,k,A,D,M,N,I,F,j,L,O,q,B;a._RF.push({},"a060eFnl61IhqI87Qgqgd9k","SpawnEnemy",void 0);var H=l.ccclass,T=l.property;e("SpawnEnemy",(w=H("SpawnEnemy"),P=T({type:s,tooltip:"要生成的丧尸预制体 (Enemy)"}),v=T({tooltip:"生成间隔 (秒)"}),z=T({tooltip:"最大同时存在数量"}),C=T({tooltip:"总生成次数限制（0表示无限制，生成达到此次数后不再生成）"}),x=T({type:p,tooltip:"生成的丧尸存放的父节点（可选，默认为当前节点的父节点）"}),E=T({type:p,tooltip:"玩家节点（赋值给 EnemyController）"}),S=T({tooltip:"怪物移动速度"}),K=T({tooltip:"怪物停止距离"}),R=T({tooltip:"怪物近战攻击范围"}),_=T({tooltip:"敌人对象池key（如果使用对象池生成敌人，需要填写此key）"}),w((D=t((A=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,i(t,"enemyPrefab",D,o(t)),i(t,"interval",M,o(t)),i(t,"maxEnemies",N,o(t)),i(t,"maxSpawnCount",I,o(t)),i(t,"enemyRoot",F,o(t)),i(t,"playerNode",j,o(t)),i(t,"enemySpeed",L,o(t)),i(t,"stopDistance",O,o(t)),i(t,"meleeAttackRange",q,o(t)),i(t,"enemyPoolKey",B,o(t)),t._timer=0,t._spawnedCount=0,t}n(t,e);var a=t.prototype;return a.start=function(){var e=this.getComponent(y);(e&&(e.isTrigger=!0),this.enemyPoolKey&&this.enemyPoolKey.length>0&&this.enemyPrefab)&&g.getInstance().registerPrefab(this.enemyPoolKey,this.enemyPrefab)},a.update=function(e){if(this.enemyPrefab&&(!(this.maxSpawnCount>0&&this._spawnedCount>=this.maxSpawnCount)&&!(this.getAliveEnemyCount()>=this.maxEnemies)&&(this._timer+=e,this._timer>=this.interval))){this._timer=0;var t=this.enemyRoot||this.node.parent;this.spawnEnemy(t)}},a.getAliveEnemyCount=function(){for(var e,t=0,n=r(b.enemies);!(e=n()).done;){var i=e.value;i&&i.node&&i.node.isValid&&i.node.active&&!i.isDead&&t++}return t},a.spawnEnemy=function(e){if(this.enemyPrefab){var t=null;if(this.enemyPoolKey&&this.enemyPoolKey.length>0)t=g.getInstance().get(this.enemyPoolKey,e||this.node.parent||this.node);else(t=u(this.enemyPrefab)).parent=e||(this.node.parent||this.node);if(t){var n=this.getRandomPosition();t.setWorldPosition(n);var i=t.getComponent(b);if(i&&(i.speed=this.enemySpeed,i.stopDistance=this.stopDistance,i.meleeAttackRange=this.meleeAttackRange,this.enemyPoolKey&&this.enemyPoolKey.length>0&&(i.poolKey=this.enemyPoolKey),this.playerNode)){i.target=this.playerNode;var o=this.playerNode.worldPosition;t.lookAt(new m(o.x,n.y,o.z))}this._spawnedCount++}else console.warn("SpawnEnemy: 无法创建敌人节点")}},a.getRandomPosition=function(){var e=this.getComponent(y),t=new m,n=0;if(this.playerNode&&(n=this.playerNode.worldPosition.y),e instanceof c){var i=e.center,o=e.size,r=h(i.x-o.x/2,i.x+o.x/2),a=h(i.z-o.z/2,i.z+o.z/2),l=new m(r,i.y,a);m.transformMat4(t,l,this.node.worldMatrix),t.y=n}else if(e instanceof f){var s=e.center,p=e.radius,u=h(0,2*Math.PI),d=h(0,p),b=s.x+Math.cos(u)*d,g=s.z+Math.sin(u)*d,w=new m(b,s.y,g);m.transformMat4(t,w,this.node.worldMatrix),t.y=n}else t.set(this.node.worldPosition),t.y=n;return t},t}(d)).prototype,"enemyPrefab",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(A.prototype,"interval",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),N=t(A.prototype,"maxEnemies",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),I=t(A.prototype,"maxSpawnCount",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),F=t(A.prototype,"enemyRoot",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(A.prototype,"playerNode",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(A.prototype,"enemySpeed",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),O=t(A.prototype,"stopDistance",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),q=t(A.prototype,"meleeAttackRange",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),B=t(A.prototype,"enemyPoolKey",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),k=A))||k));a._RF.pop()}}}));

System.register("chunks:///_virtual/TurretController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EnemyController.ts","./BulletController.ts","./ShellController.ts","./ObjectPool.ts"],(function(e){var t,l,i,r,o,n,a,u,s,f,b,h,c,p,g,d,P,y;return{setters:[function(e){t=e.applyDecoratedDescriptor,l=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,o=e.createForOfIteratorHelperLoose},function(e){n=e.cclegacy,a=e._decorator,u=e.Prefab,s=e.Node,f=e.Vec3,b=e.Quat,h=e.instantiate,c=e.randomRange,p=e.Component},function(e){g=e.EnemyController},function(e){d=e.BulletController},function(e){P=e.ShellController},function(e){y=e.ObjectPool}],execute:function(){var m,w,v,T,R,z,S,k,A,C,I,K,_,O,B,x,L,U,D,E,M,N,V,W,j,q,F;n._RF.push({},"c3133iuXiJPIYMpuvxA1HE7","TurretController",void 0);var H=a.ccclass,Q=a.property;e("TurretController",(m=H("TurretController"),w=Q({tooltip:"攻击范围"}),v=Q({tooltip:"攻击间隔（秒）"}),T=Q({type:u,tooltip:"子弹预制体（普通子弹）"}),R=Q({type:u,tooltip:"炮弹预制体（抛物线炮弹）"}),z=Q({tooltip:"使用炮弹（true=使用炮弹，false=使用普通子弹）"}),S=Q({type:s,tooltip:"子弹发射点（不填则用自身位置）"}),k=Q({type:s,tooltip:"子弹挂载父节点（不填则用当前节点父节点）"}),A=Q({tooltip:"子弹速度"}),C=Q({tooltip:"子弹存活时间（秒）"}),I=Q({tooltip:"旋转速度（度/秒）"}),K=Q({tooltip:"子弹发射角度随机偏移范围（度）"}),_=Q({tooltip:"子弹对象池key（如果使用对象池生成子弹，需要填写此key）"}),m((x=t((B=function(e){function t(){for(var t,l=arguments.length,o=new Array(l),n=0;n<l;n++)o[n]=arguments[n];return t=e.call.apply(e,[this].concat(o))||this,i(t,"attackRange",x,r(t)),i(t,"attackInterval",L,r(t)),i(t,"bulletPrefab",U,r(t)),i(t,"shellPrefab",D,r(t)),i(t,"useShell",E,r(t)),i(t,"firePoint",M,r(t)),i(t,"bulletRoot",N,r(t)),i(t,"bulletSpeed",V,r(t)),i(t,"bulletLifeTime",W,r(t)),i(t,"rotationSpeed",j,r(t)),i(t,"bulletAngleOffsetRange",q,r(t)),i(t,"bulletPoolKey",F,r(t)),t._attackTimer=0,t._currentTarget=null,t}l(t,e);var n=t.prototype;return n.start=function(){(this._attackTimer=this.attackInterval,this.bulletPoolKey&&this.bulletPoolKey.length>0&&this.bulletPrefab)&&y.getInstance().registerPrefab(this.bulletPoolKey,this.bulletPrefab)},n.update=function(e){this._attackTimer+=e;var t=this.findNearestEnemy();t?(this.rotateTowardsTarget(t,e),this._attackTimer>=this.attackInterval&&(this.fireBullet(t),this._attackTimer=0)):this._currentTarget=null},n.findNearestEnemy=function(){for(var e,t=this.node.worldPosition,l=g.enemies,i=null,r=this.attackRange*this.attackRange,n=o(l);!(e=n()).done;){var a=e.value;if(a.node&&a.node.active&&!a.isDead){var u=a.node.worldPosition,s=u.x-t.x,f=u.y-t.y,b=u.z-t.z,h=s*s+f*f+b*b;h<=r&&(r=h,i=a.node)}}return this._currentTarget=i,i},n.rotateTowardsTarget=function(e,t){var l=this.node.worldPosition,i=e.worldPosition,r=new f;if(f.subtract(r,i,l),r.y=0,!(r.lengthSqr()<1e-4)){r.normalize();var o=new b;b.fromViewUp(o,r,f.UP);var n=this.node.worldRotation.clone(),a=new b,u=Math.min(1,this.rotationSpeed/180*t);b.slerp(a,n,o,u),this.node.setWorldRotation(a)}},n.fireBullet=function(e){this.useShell&&this.shellPrefab?this.fireShell(e):this.bulletPrefab&&this.fireNormalBullet(e)},n.fireNormalBullet=function(e){if(this.bulletPrefab){var t=null,l=this.bulletRoot||this.node.parent||this.node;if(this.bulletPoolKey&&this.bulletPoolKey.length>0)t=y.getInstance().get(this.bulletPoolKey,l);else(t=h(this.bulletPrefab)).parent=l||(this.node.parent||this.node);if(t){var i=this.firePoint?this.firePoint.worldPosition:this.node.worldPosition;t.setWorldPosition(i);var r=e.worldPosition,o=new f;if(f.subtract(o,r,i),o.y=0,o.lengthSqr()>1e-4?o.normalize():o.set(0,0,-1),this.bulletAngleOffsetRange>0){var n=c(-this.bulletAngleOffsetRange,this.bulletAngleOffsetRange)*Math.PI/180,a=new b;b.fromAxisAngle(a,f.UP,n),f.transformQuat(o,o,a)}var u=new b;b.fromViewUp(u,o,f.UP),t.setWorldRotation(u);var s=t.getComponent(d);s&&(s.speed=this.bulletSpeed,s.lifeTime=this.bulletLifeTime,this.bulletPoolKey&&this.bulletPoolKey.length>0&&(s.poolKey=this.bulletPoolKey),s.setDirection(o))}else console.warn("TurretController: 无法创建子弹节点")}},n.fireShell=function(e){if(this.shellPrefab){var t=h(this.shellPrefab),l=this.bulletRoot||this.node.parent;t.parent=l||(this.node.parent||this.node);var i=this.firePoint?this.firePoint.worldPosition:this.node.worldPosition;t.setWorldPosition(i);var r=e.worldPosition,o=new f;if(f.subtract(o,r,i),o.y=0,o.lengthSqr()>1e-4?o.normalize():o.set(0,0,-1),this.bulletAngleOffsetRange>0){var n=c(-this.bulletAngleOffsetRange,this.bulletAngleOffsetRange)*Math.PI/180,a=new b;b.fromAxisAngle(a,f.UP,n),f.transformQuat(o,o,a)}var u=t.getComponent(P);u&&u.setInitialVelocityToTarget(o,r,this.bulletSpeed)}},t}(p)).prototype,"attackRange",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),L=t(B.prototype,"attackInterval",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),U=t(B.prototype,"bulletPrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(B.prototype,"shellPrefab",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(B.prototype,"useShell",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),M=t(B.prototype,"firePoint",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(B.prototype,"bulletRoot",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(B.prototype,"bulletSpeed",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),W=t(B.prototype,"bulletLifeTime",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),j=t(B.prototype,"rotationSpeed",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 180}}),q=t(B.prototype,"bulletAngleOffsetRange",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),F=t(B.prototype,"bulletPoolKey",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),O=B))||O));n._RF.pop()}}}));

System.register("chunks:///_virtual/UIManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FailButtonHandler.ts","./AttackWarning.ts"],(function(i){var t,e,o,n,a,s,d,h,l;return{setters:[function(i){t=i.createClass,e=i.inheritsLoose},function(i){o=i.cclegacy,n=i._decorator,a=i.director,s=i.find,d=i.Component},function(i){h=i.FailButtonHandler},function(i){l=i.AttackWarning}],execute:function(){var c;o._RF.push({},"4a8acB0vMZOEL1rL/t/5seS","UIManager",void 0);var _=n.ccclass,N=i("UIManager",function(){function i(){this._uiRoot=null,this._joystickNode=null,this._winNode=null,this._failNode=null,this._attackWarningNode=null}i.getInstance=function(){return i._instance||(i._instance=new i),i._instance},i.resetInstance=function(){i._instance=null};var e=i.prototype;return e.initialize=function(){this._uiRoot=null,this._joystickNode=null,this._winNode=null,this._failNode=null,this._attackWarningNode=null;var i=a.getScene();i&&(this._uiRoot=s("UiRoot")||this.findNodeByName(i,"UiRoot"),this._uiRoot&&(this._joystickNode=this._uiRoot.getChildByName("joystick"),this._winNode=this._uiRoot.getChildByName("Win"),this._failNode=this._uiRoot.getChildByName("Fail"),this._attackWarningNode=this._uiRoot.getChildByName("AttackWarning"),this._failNode&&this._failNode.isValid&&(this._failNode.getComponent(h)||this._failNode.addComponent(h)),this._joystickNode&&this._joystickNode.isValid&&(this._joystickNode.active=!0),this._winNode&&this._winNode.isValid&&(this._winNode.active=!1),this._failNode&&this._failNode.isValid&&(this._failNode.active=!1),this._attackWarningNode&&this._attackWarningNode.isValid&&(this._attackWarningNode.active=!0)))},e.showJoystick=function(){this._joystickNode&&(this._joystickNode.active=!0)},e.hideJoystick=function(){this._joystickNode&&(this._joystickNode.active=!1)},e.showWin=function(){this._winNode&&(this._winNode.active=!0)},e.hideWin=function(){this._winNode&&this._winNode.isValid?this._winNode.active=!1:(this.refreshNodes(),this._winNode&&this._winNode.isValid&&(this._winNode.active=!1))},e.showFail=function(){this._failNode&&this._failNode.isValid?this._failNode.active=!0:(this.refreshNodes(),this._failNode&&this._failNode.isValid&&(this._failNode.active=!0))},e.hideFail=function(){this._failNode&&this._failNode.isValid?this._failNode.active=!1:(this.refreshNodes(),this._failNode&&this._failNode.isValid&&(this._failNode.active=!1))},e.showFailAndCloseOthers=function(){if(!this._failNode||!this._failNode.isValid){var i=a.getScene();if(i){var t=s("UiRoot")||this.findNodeByName(i,"UiRoot");t&&(this._failNode=t.getChildByName("Fail"))}}if(this._joystickNode&&this._joystickNode.isValid&&(this._joystickNode.active=!1),this._winNode&&this._winNode.isValid&&(this._winNode.active=!1),this._failNode&&this._failNode.isValid){this._failNode.active=!0;var e=this._failNode.getComponent(h);e||(e=this._failNode.addComponent(h))}},e.refreshNodes=function(){if(!this._uiRoot||!this._uiRoot.isValid){var i=a.getScene();i&&(this._uiRoot=s("UiRoot")||this.findNodeByName(i,"UiRoot"))}this._uiRoot&&this._uiRoot.isValid&&(this._joystickNode&&this._joystickNode.isValid||(this._joystickNode=this._uiRoot.getChildByName("joystick")),this._winNode&&this._winNode.isValid||(this._winNode=this._uiRoot.getChildByName("Win")),this._failNode&&this._failNode.isValid||(this._failNode=this._uiRoot.getChildByName("Fail")),this._attackWarningNode&&this._attackWarningNode.isValid||(this._attackWarningNode=this._uiRoot.getChildByName("AttackWarning")))},e.findNodeByName=function(i,t){if(!i||!i.isValid)return null;if(i.name===t)return i;var e=i.children;if(e)for(var o=0;o<e.length;o++){var n=e[o];if(n&&n.isValid){var a=this.findNodeByName(n,t);if(a)return a}}return null},e.playAttackWarning=function(){if(this._attackWarningNode&&this._attackWarningNode.isValid||this.refreshNodes(),this._attackWarningNode&&this._attackWarningNode.isValid){var i=this._attackWarningNode.getComponent(l);i&&i.play()}},t(i,null,[{key:"instance",get:function(){return i._instance}}]),i}());N._instance=null;i("UIManagerComponent",_("UIManagerComponent")(c=function(i){function t(){return i.apply(this,arguments)||this}e(t,i);var o=t.prototype;return o.onLoad=function(){N.resetInstance()},o.start=function(){N.getInstance().initialize()},t}(d))||c);o._RF.pop()}}}));

System.register("chunks:///_virtual/VFXManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ObjectPool.ts"],(function(t){var e,n,i,o,a,r,c,s,l;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,i=t._decorator,o=t.ParticleSystem,a=t.Animation,r=t.director,c=t.Node,s=t.Component},function(t){l=t.ObjectPool}],execute:function(){var u,h;n._RF.push({},"6bbaczXGctOFY4NSQdlnz4U","VFXManager",void 0);var f=i.ccclass,_=t("VFXManager",function(){function t(){this._objectPool=void 0,this._activeVFX=new Map,this._prefabToKey=new Map,this._poolRoot=null,this._objectPool=l.getInstance()}t.getInstance=function(){return t._instance||(t._instance=new t),t._instance};var e=t.prototype;return e.setPoolRoot=function(t){this._poolRoot=t,this._objectPool.setPoolRoot(t)},e.getPoolKey=function(t){if(this._prefabToKey.has(t))return this._prefabToKey.get(t);var e=t._uuid?"VFX_"+t._uuid:"VFX_"+(t.name||"Unknown");return this._prefabToKey.set(t,e),this._objectPool.isRegistered(e)||this._objectPool.registerPrefab(e,t),e},e.resetVFXComponents=function(t){if(t&&t.isValid)try{var e=t.getComponent(o);e&&(e.stop(),e.enabled=!0,e.play());var n=t.getComponent(a);if(n){n.stop();var i=n.clips;i&&i.length>0&&n.play(i[0].name)}for(var r=t.children,c=0;c<r.length;c++){var s=r[c];s&&s.isValid&&this.resetVFXComponents(s)}}catch(t){}},e.activateNodeAndChildren=function(t){if(t&&t.isValid)try{t.active||(t.active=!0);for(var e=t.children,n=0;n<e.length;n++){var i=e[n];i&&i.isValid&&this.activateNodeAndChildren(i)}}catch(t){}},e.playVFX=function(t,e,n,i,o,a){if(void 0===o&&(o=!0),void 0===a&&(a=1),!t)return null;var r=this.getPoolKey(t),c=this._objectPool.get(r,i);return c&&c.isValid?(c.setWorldPosition(e),n&&c.setWorldRotation(n),c.active||(c.active=!0),this.activateNodeAndChildren(c),this.resetVFXComponents(c),o&&!this._activeVFX.has(c)&&this._activeVFX.set(c,{node:c,prefab:t,poolKey:r,autoRecycle:!0,lifeTime:a,elapsedTime:0}),c):null},e.play=function(t,e,n){return d.ensureInstance(),this.playVFX(t,e,null,n,!0,1)},e.recycleVFX=function(t){if(t&&t.isValid){var e=this._activeVFX.get(t);e?(this._activeVFX.delete(t),this._objectPool.put(e.poolKey,t)):this._objectPool.put(t.name,t)}},e.recycle=function(t){this.recycleVFX(t)},e.update=function(t){var e=this;if(0!==this._activeVFX.size){var n=[];this._activeVFX.forEach((function(e,i){i&&i.isValid&&i.active?(e.elapsedTime+=t,e.elapsedTime>=e.lifeTime&&n.push(i)):n.push(i)})),n.forEach((function(t){e.recycleVFX(t)}))}},e.clearAll=function(){var t=this,e=[];this._activeVFX.forEach((function(t,n){n&&n.isValid&&e.push(n)})),e.forEach((function(e){t.recycleVFX(e)})),this._activeVFX.clear()},e.preloadVFX=function(t,e){if(t){var n=this.getPoolKey(t);this._objectPool.preload(n,e,this._poolRoot)}},e.clearPool=function(t){if(t){var e=this.getPoolKey(t);this._objectPool.clear(e)}},e.getPoolSize=function(t){if(!t)return 0;var e=this.getPoolKey(t);return this._objectPool.getPoolSize(e)},e.getActiveVFXCount=function(){return this._activeVFX.size},t}());_._instance=null;var d=t("VFXManagerUpdater",f("VFXManagerUpdater")(((h=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this)._vfxManager=null,e}e(n,t),n.ensureInstance=function(){if(n._instance&&n._instance.node&&n._instance.node.isValid)return n._instance;var t=r.getScene();if(t){var e=t.getComponentInChildren(n);if(e)return n._instance=e,e;var i=new c("VFXManagerUpdater");i.parent=t;var o=i.addComponent(n);return n._instance=o,o}return null};var i=n.prototype;return i.onLoad=function(){n._instance&&n._instance.node&&n._instance.node.isValid||(n._instance=this)},i.start=function(){this._vfxManager=_.getInstance()},i.update=function(t){this._vfxManager&&this._vfxManager.update(t)},i.onDestroy=function(){n._instance===this&&(n._instance=null),this._vfxManager&&this._vfxManager.clearAll()},n}(s))._instance=null,u=h))||u);n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});